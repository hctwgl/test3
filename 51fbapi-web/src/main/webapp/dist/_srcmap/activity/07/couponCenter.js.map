{"version":3,"sources":["activity/07/couponCenter.js"],"names":["tabWidth","liWidth","ulWidth","el","vm","content","this","logData","methods","self","$","ajax","type","success","data","format","stramp","time","Date","y","m","getMonth","getDate","getFullYear","d","url","eval","log","console","undefined","bannerImage","css","couponCategoryList","length","$nextTick","liLength","addClass","eq","width","n","x","find","fiveLiWidth","diff","i","couponCategory","currentTime","couponInfoList","j","startTime","gmtStart","endTime","state","h","parseInt","k","gmtEnd","error","liClick","index","requestMsg","siblings","removeClass","show","hide","couponClick","e","couponId","shopUrl","couponType","isDraw","window","location","dataType","returnData","status","href","msg"],"mappings":"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","file":"../../../activity/07/couponCenter.js","sourcesContent":["var tabWidth=0;\r\nvar liWidth=0;\r\nvar ulWidth=0;\r\n//获取数据\r\nlet vm = new Vue({\r\n    el: '#couponCenter',\r\n    data: {\r\n        content: {}\r\n    },\r\n    created: function () {\r\n        this.logData();        \r\n    },\r\n    methods: {\r\n        logData() {\r\n            //获取页面初始化信息\r\n            let self = this;\r\n            $.ajax({\r\n                type: 'post',\r\n                url: \"/fanbei-web/couponCategoryInfo\",\r\n                success: function (data) {\r\n                    self.content = eval('(' + data + ')').data;\r\n                    console.log(self.content);\r\n                    //判断banner图是否存在\r\n                    if(self.content.bannerImage=='' || self.content.bannerImage==undefined){\r\n                        $('.banner').css('display','none');\r\n                    }\r\n                    var liLength=self.content.couponCategoryList.length;\r\n                    self.$nextTick(function () {//tab计算样式\r\n                        $('.navList li').eq(0).addClass('border');\r\n                        $('.contList li').eq(0).addClass('active'); //dom渲染完成后执行\r\n                        \r\n                        if(liLength<2){\r\n                             $('#tabNav').hide();\r\n                             $('#content').css('padding-top',0);\r\n                        }else if(liLength>=2&&liLength<=5){                      \r\n                             tabWidth=$('#tabNav').width();\r\n                             for(var n=0;n<liLength;n++){\r\n                                liWidth+=$('.navList').find('li').eq(n).width();\r\n                             }\r\n                             var x=(tabWidth-liWidth)/(liLength+1);  //margin值\r\n                             //console.log(x)\r\n                             $('.navList').find('li').css('margin-left',x);                                              \r\n                        }else{\r\n                             tabWidth=$('#tabNav').width();\r\n                             var fiveLiWidth=0;\r\n                             for(var m=0;m<5;m++){\r\n                                fiveLiWidth+=$('.navList').find('li').eq(m).width();\r\n                             }\r\n                             for(var n=0;n<liLength;n++){\r\n                                liWidth+=$('.navList').find('li').eq(n).width();\r\n                             }\r\n                             var x=(tabWidth-fiveLiWidth)/6;  //margin值                           \r\n                             $('.navList').find('li').css('margin-left',x);\r\n                             $('.kong').css('width',x) \r\n                             ulWidth=liWidth+(liLength+1)*x;\r\n                             $('.navList').width(ulWidth);\r\n                             //console.log(liWidth)\r\n                        }\r\n                    })\r\n                    //计算排序与即将到期\r\n                    var diff=0;\r\n                    for(var i=0;i<liLength;i++){\r\n                        var couponCategory=self.content.couponCategoryList[i];\r\n                        //console.log(couponCategory.couponInfoList) \r\n                        //即将到期 \r\n                        for(var j=0;j<couponCategory.couponInfoList.length;j++){                             \r\n                             var currentTime=couponCategory.couponInfoList[j].currentTime;\r\n                             var startTime=couponCategory.couponInfoList[j].gmtStart;\r\n                             var endTime=couponCategory.couponInfoList[j].gmtEnd;\r\n                             //console.log(endTime)\r\n                             couponCategory.couponInfoList[j].start=format(startTime);\r\n                             couponCategory.couponInfoList[j].end=format(endTime);\r\n                             //console.log(couponCategory.couponInfoList[j].end)\r\n                             diff=(endTime-currentTime)/1000;\r\n                             var h=parseInt(diff/3600);                            \r\n                             var state;\r\n                             if(0<h&&h<48){\r\n                                state='timeOver';                                \r\n                             }else{\r\n                                state='noTimeOver';\r\n                             }\r\n                             couponCategory.couponInfoList[j].state=state;                                          \r\n                        }\r\n                        //排序   \r\n                        for(var j=0;j<couponCategory.couponInfoList.length;j++){\r\n                            for(var k = 0;k<couponCategory.couponInfoList.length;k++){                    \r\n                                if(couponCategory.couponInfoList[j].gmtEnd<couponCategory.couponInfoList[k].gmtEnd){\r\n                                    var tmp = couponCategory.couponInfoList[k];\r\n                                    couponCategory.couponInfoList[k] = couponCategory.couponInfoList[j];\r\n                                    couponCategory.couponInfoList[j] = tmp;\r\n                                }\r\n                            }\r\n                        }\r\n                                                          \r\n                    }\r\n                    //计算年月日                   \r\n                    function format(stramp) { //stramp是整数，否则要parseInt转换 \r\n                        var time = new Date(stramp); \r\n                        var y = time.getFullYear(); \r\n                        var m = time.getMonth()+1; \r\n                        var d = time.getDate();\r\n                        if(m<10){m='0'+m} \r\n                        if(d<10){d='0'+d}\r\n                        return y+'.'+m+'.'+d; \r\n                    } \r\n\r\n                },\r\n                error: function () {\r\n                    requestMsg(\"请求失败\");\r\n                }\r\n            });\r\n        },       \r\n        liClick:function(index){\r\n            //console.log(index);\r\n            $('.navList li').eq(index).addClass('border');\r\n            $('.navList li').eq(index).siblings().removeClass('border');\r\n            $('.contList').find('li').eq(index).show().siblings().hide();         \r\n        },\r\n        couponClick:function(e){\r\n            let self=this;\r\n            var couponId=e.couponId;\r\n            var shopUrl=e.shopUrl;\r\n            var couponType=e.type;\r\n            //只有现金券、满减券、会场券时，券状态有去用券 可点击跳转 其他不可\r\n                if(e.isDraw=='N' && (couponType=='FULLVOUCHER' || couponType=='CASH' || couponType=='ACTIVITY')){                 \r\n                    //去用券\r\n                    if(shopUrl){\r\n                        window.location.href=shopUrl;\r\n                    }else{\r\n                        window.location.href='/fanbei-web/opennative?name=APP_HOME';\r\n                    }\r\n                }else if(e.isDraw=='Y'){\r\n                    //点击领券\r\n                    //console.log(1)\r\n                        $.ajax({\r\n                            url: \"/fanbei-web/pickCoupon\",\r\n                            type: \"POST\",\r\n                            dataType: \"JSON\",\r\n                            data: {\r\n                                couponId:couponId\r\n                            },\r\n                            success: function(returnData){\r\n                                if(returnData.success){\r\n                                   requestMsg(\"优惠劵领取成功\");\r\n                                   e.isDraw='N';                           \r\n                                }else{\r\n                                    var status = returnData.data[\"status\"];\r\n                                    if (status == \"USER_NOT_EXIST\") { // 用户不存在                                \r\n                                        window.location.href = returnData.url;\r\n                                    }\r\n                                    if (status == \"OVER\") { // 优惠券个数超过最大领券个数\r\n                                        requestMsg(returnData.msg);\r\n                                        requestMsg(\"优惠券个数超过最大领券个数\");\r\n                                    }\r\n                                    if (status == \"COUPON_NOT_EXIST\") { // 优惠券不存在\r\n                                        requestMsg(returnData.msg);\r\n                                        $(\".couponLi\").eq(i).css('display', 'none');\r\n                                    } \r\n                                }\r\n                            },\r\n                            error: function(){\r\n                                requestMsg(\"请求失败\");\r\n                            }\r\n                        });\r\n                }     \r\n        }//couponClick--\r\n\r\n    }\r\n})\r\n"]}
{"version":3,"sources":["activity/07/robCoupon.js"],"names":["activityId","getUrl","el","vm","content","data","couponContent","this","logData","methods","self","$","ajax","url","type","success","showTime","time","diff","parseInt","currentTime","hour","minute","floor","second","Math","find","eq","html","interval","start","currentTen","currentFourteen","nextTen","end","hide","setInterval","eval","console","validStartTime","validEndTime","date","Date","year","month","getMonth","day","getDate","dateStr01","dateStr02","getTime","dateStr03","error","requestMsg","log","id","ruleClick","maskClick","buyNow","window","location","couponInfoList","index","couponId","userName","show","couponClick","couponIdNum","returnData","status","href","txtFix","i","str","len","char_length","length","son_str","charAt","encodeURI","get_length","sub_len"],"mappings":"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","file":"../../../activity/07/robCoupon.js","sourcesContent":["/**\r\n * Created on 2017/07/10.\r\n */\r\nvar activityId = getUrl(\"activityId\");\r\n//console.log(activityId)\r\nlet vm=new Vue({\r\n    el:'#robCoupon',\r\n    data:{\r\n        content:{},\r\n        couponContent:{}\r\n    },\r\n    created:function () {\r\n        this.logData();\r\n    },\r\n    methods:{\r\n        logData(){\r\n            //获取页面初始化信息\r\n            let self=this;\r\n            $.ajax({\r\n                    type: 'post',\r\n                    url: '/fanbei-web/encoreActivityInfo',\r\n                    data:{'activityId':activityId},\r\n                    success:function(data) {                      \r\n                      self.content = eval('(' + data + ')');                      \r\n                      self.content = self.content.data;  \r\n                      console.log(self.content)\r\n                      var currentTime = self.content.currentTime;//2017/7/11 13:58:49\r\n                      var validStartTime = self.content.validStartTime+3600*10*1000;//活动开始准确时间2017/7/11 10:0:0\r\n                      var validEndTime = self.content.validEndTime;//活动结束时间\r\n                      var date=new Date(currentTime);//当前日期\r\n                      var year=date.getFullYear();\r\n                      var month=date.getMonth()+1;\r\n                      var day=date.getDate();\r\n                      var dateStr01=year+'/'+month+'/'+day+' '+'10:00:00'; //今天10:00                      \r\n                      var dateStr02=year+'/'+month+'/'+day+' '+'14:00:00'; //今天14:00\r\n                      var dateStr03=year+'/'+month+'/'+(day+1)+' '+'10:00:00'; //明天10:00\r\n                      var currentTen= new Date(dateStr01).getTime();                         \r\n                      var currentFourteen= new Date(dateStr02).getTime();\r\n                      var nextTen= new Date(dateStr03).getTime();                                          \r\n                      /*console.log(currentTime)\r\n                      console.log(currentFourteen)\r\n                      console.log(nextTen)*/\r\n                      var diff=0;\r\n                      function showTime(time){\r\n                          diff=parseInt((time-currentTime)/1000);\r\n                          var hour=0,\r\n                              minute=0,\r\n                              second=0;                           \r\n                            hour = Math.floor(diff / (60 * 60));\r\n                            minute = Math.floor(diff / 60) - (hour * 60);\r\n                            second = Math.floor(diff) - (hour * 60 * 60) - (minute * 60);\r\n                              if (hour <= 9) {hour = '0' + hour;}\r\n                              if (minute <= 9) {minute = '0' + minute;}\r\n                              if (second <= 9) {second = '0' + second;}\r\n                              $('.countTime').find('span').eq(0).html(hour);\r\n                              $('.countTime').find('span').eq(1).html(minute);\r\n                              $('.countTime').find('span').eq(2).html(second);\r\n                      }\r\n                      function interval(start,currentTen,currentFourteen,nextTen,end){\r\n                            if(currentTime<start){\r\n                                //活动未开始                                \r\n                                showTime(start);\r\n                                $('.timeName').html('10:00');                                         \r\n                            }else if(currentTime>=start&&currentTime<end){\r\n                                if(currentTime<currentTen){                                 \r\n                                    showTime(currentTen);\r\n                                    $('.timeName').html('14:00');\r\n                                }else if(currentTime>=currentTen&&currentTime<currentFourteen){                                 \r\n                                    showTime(currentFourteen);\r\n                                    $('.timeName').html('10:00');\r\n                                }else if(currentTime>=currentFourteen){                                 \r\n                                    showTime(nextTen);\r\n                                    $('.timeName').html('14:00');\r\n                                }\r\n                            }else{\r\n                                //活动结束\r\n                                $('.timeName').html('14:00');\r\n                                $('.desWord').find('p').eq(2).hide();\r\n                                $('.countTime').hide();\r\n                            }\r\n                            //倒计时                           \r\n                            let time1=setInterval(function(){\r\n                                if(currentTime<start){\r\n                                    //活动未开始\r\n                                    //start-=1000;\r\n                                    currentTime+=1000;\r\n                                    showTime(start);\r\n                                    $('.timeName').html('10:00');                                         \r\n                                }else if(currentTime>=start&&currentTime<end){\r\n                                    if(currentTime<currentTen){//活动期间小于10:00\r\n                                      showTime(currentTen);\r\n                                      //currentTen-=1000;\r\n                                      currentTime+=1000;\r\n                                      $('.timeName').html('14:00');\r\n                                    }else if(currentTime>=currentTen&&currentTime<currentFourteen){//活动期间10:00-14:00                                      \r\n                                      showTime(currentFourteen);\r\n                                      //currentFourteen-=1000;\r\n                                      currentTime+=1000;\r\n                                      $('.timeName').html('10:00');\r\n                                    }else if(currentTime>=currentFourteen){//14点场之后\r\n                                      showTime(nextTen);\r\n                                      //nextTen-=1000;\r\n                                      currentTime+=1000;\r\n                                      $('.timeName').html('14:00');                                      \r\n                                    }\r\n                                }else{\r\n                                    //活动结束\r\n                                    $('.timeName').html('14:00');\r\n                                    $('.desWord').find('p').eq(2).hide();\r\n                                    $('.countTime').hide();\r\n                                }\r\n                            }, 1000);\r\n\r\n                        }//定时器\r\n                       interval(validStartTime,currentTen,currentFourteen,nextTen,validEndTime);\r\n                    }, \r\n                    error:function(){\r\n                       requestMsg(\"请求失败\");\r\n                    }\r\n                });\r\n            $.ajax({\r\n              type: 'post',\r\n              url: '/fanbei-web/superCouponList',\r\n              success:function(data) {                      \r\n                self.couponContent = eval('(' + data + ')');                      \r\n                self.couponContent = self.couponContent.data;  \r\n                console.log(self.couponContent)                \r\n              }, \r\n              error:function(){\r\n                 requestMsg(\"请求失败\");\r\n              }\r\n            })\r\n        },\r\n        buyNow(id){\r\n          let self=this;            \r\n          window.location.href=self.content.notifyUrl+'&params={\"goodsId\":\"'+id+'\"}'\r\n        },\r\n        ruleClick(){\r\n          $('.mask').show();\r\n          $('.rule').show();\r\n        },\r\n        maskClick(){\r\n          $('.mask').hide();\r\n          $('.rule').hide();\r\n        },\r\n        couponClick(index){\r\n           let self=this;    \r\n           var couponIdNum=self.couponContent.couponInfoList[index].couponId;\r\n           var userName=self.couponContent.userName;\r\n           //console.log(couponIdNum)\r\n           if(self.content.currentTime<self.content.validStartTime+3600*10*1000){\r\n              requestMsg(\"活动未开始，请稍候！\");\r\n           }else if(self.content.currentTime>self.content.validEndTime){\r\n              requestMsg(\"活动已结束！\");\r\n           }else{\r\n                 $.ajax({\r\n                         url: \"/fanbei-web/pickCoupon\",\r\n                         type: \"POST\",\r\n                         dataType: \"JSON\",\r\n                         data: {\r\n                             couponId: couponIdNum,\r\n                             userName: userName\r\n                         },\r\n                         success: function(returnData){\r\n                             if (returnData.success) {\r\n                                 requestMsg(\"优惠劵领取成功！\");\r\n                             } else {\r\n                                 var status = returnData.data[\"status\"];\r\n                                 if (status == \"USER_NOT_EXIST\") { // 用户不存在\r\n                                     window.location.href = returnData.url;\r\n                                 }\r\n                                 if (status == \"OVER\") { // 优惠券个数超过最大领券个数\r\n                                     requestMsg(\"优惠券个数超过最大领券个数\");\r\n                                 }\r\n                                 if (status == \"MORE_THAN\") { // 优惠券已领取完\r\n                                     requestMsg(\"已抢完，请等下一场！\");\r\n                                 }\r\n                             }\r\n                         },\r\n                         error: function(){\r\n                             requestMsg(\"请求失败\");\r\n                         }\r\n                 });\r\n           }          \r\n        },\r\n        txtFix(i){\r\n            function get_length(s){\r\n                var char_length = 0;\r\n                for (var i = 0; i < s.length; i++){\r\n                    var son_char = s.charAt(i);\r\n                    encodeURI(son_char).length > 2 ? char_length += 1 : char_length += 0.5;\r\n                }\r\n                return char_length;\r\n            }\r\n            function cut_str(str, len){\r\n                var char_length = 0;\r\n                for (var i = 0; i < str.length; i++){\r\n                    var son_str = str.charAt(i);\r\n                    encodeURI(son_str).length > 2 ? char_length += 1 : char_length += 0.5;\r\n                    if (char_length >= len){\r\n                        var sub_len = char_length == len ? i+1 : i;\r\n                        return str.substr(0, sub_len);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return cut_str(i, 20)\r\n        }\r\n        \r\n    }\r\n});\r\n"]}
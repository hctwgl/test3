{"version":3,"sources":["js/goods/goodsListModel.js"],"names":["goodsList1","$","val","goodsList","eval","notifyUrl","finished","addModel","dom","state","length","j","saleAmount","amountAmountSplitArr","split","amountAmountPriceInteger","con1","amountAmountPriceDecimal","goodsType","toDecimal2","nperMap","nper","amount","goodsId","html","name","rebateAmount","con","page","append","container","windowW","element","addEventListener","Swipe","ele","_classCallCheck","this","type","children","distance","speed","a","isScrolling","start","pageX","startDistance","stopPropagation","deltaX","touches","pageY","style","MozTransitionDuration","webkitTransitionDuration","Math","abs","clientWidth","left","document","getElementById","liWArr","thisLiW","outerWidth","index","width","offsetLeft","ulW","css","modelIdNum","getUrl","e","preventDefault","i","find","siblings","categoryObj","removeClass","typeCurrentNum","ulOffsetLeft","offset","thisLiOffsetUl","thisLiOffsetDiv","hide","isUl","ajax","url","dataType","data","modelId","pageNo","success","requestMsg","msg","window","scrollTop","allHeight","windowHeight","height","returnData"],"mappings":"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","file":"../../../js/goods/goodsListModel.js","sourcesContent":["/*\r\n* @Author: yoe\r\n* @Date:   2017-02-23 14:11:41\r\n* @Last Modified by:   yoe\r\n* @Last Modified time: 2017-05-11 14:21:03\r\n*/\r\n\r\nlet goodsList1 = $('#goodsList').val();\r\nlet goodsList=eval('(' + goodsList1 + ')'); //初始商品数据\r\n\r\nlet notifyUrl = $(\"#notifyUrl\").val();//商品跳转原生的链接\r\n\r\nlet finished = 0;//防止多次请求ajax\r\n\r\n//填充商品数据\r\nlet addModel = function addModel(goodsList,dom,state) {\r\n    let con='',html = '';\r\n    if(goodsList.length>0){\r\n        // 下拉的时候加载\r\n        for (let j = 0; j < goodsList.length; j++) {\r\n            // 售价\r\n            var saleAmount = toDecimal2(goodsList[j].saleAmount);\r\n            var amountAmountSplitArr = saleAmount.split(\".\");\r\n            var amountAmountPriceInteger = amountAmountSplitArr[0];\r\n            var amountAmountPriceDecimal = amountAmountSplitArr[1];\r\n            let con1=`<p class=\"fs_28 fsc_red\" style=\"padding-top: .3rem;padding-bottom: .25rem\">\r\n                    <span>￥${amountAmountPriceInteger}</span><span class=\"fs_22\">.${amountAmountPriceDecimal}</span>`;\r\n            if(goodsList[j].goodsType==1){\r\n                let amount=` <span>￥${goodsList[j].nperMap.amount}</span><span class=\"fs_22\">×${goodsList[j].nperMap.nper}期</span>`;\r\n                if(goodsList[j].nperMap.isFree==1){\r\n                    amount=` <span>￥${goodsList[j].nperMap.freeAmount}</span><span class=\"fs_22\">×${goodsList[j].nperMap.nper}期</span>`;\r\n                }\r\n                con=`<div class=\"goodsListModel_mainContent_rebate_wrap\">\r\n                    <div class=\"goodsListModel_mainContent_rebate clearfix\">\r\n                        <span class=\"goodsListModel_rebate fl fs_22 bgc_orange fsc_f tac\">月供</span>\r\n                        <p class=\"fl fs_24 fsc_orange\">\r\n                            ${amount}\r\n                        </p>\r\n                    </div>\r\n                </div>`;\r\n                con1=` <p class=\"fs_26 fsc_red\">\r\n                       <span>￥${amountAmountPriceInteger}</span><span class=\"fs_20\">.${amountAmountPriceDecimal}</span>`\r\n            }\r\n            let goodInfoUrl = notifyUrl + '&params={\"goodsId\":\"'+goodsList[j].goodsId+'\"}';\r\n            html += `<li class=\"goodsListModel_item\">\r\n                    <a href='${goodInfoUrl}'>\r\n                        <img src=\" ${goodsList[j].goodsIcon}\" class=\"mainContent_img\">\r\n                        <div class=\"goodsListModel_mainContent_wrap\">\r\n                            <p class=\"fs_26 fsc_1\">${goodsList[j].name}</p>\r\n                            ${con1}\r\n                                <span class=\"fs_24\"><i class=\"ba\">返</i>￥${goodsList[j].rebateAmount}</span>\r\n                            </p>\r\n                        </div>\r\n                        ${con}\r\n                    </a>\r\n                </li>`;\r\n        }\r\n        finished=0;\r\n    }else{\r\n        html =  `<div class=\"nullPrompt\">\r\n            <img src=\"http://51fanbei.oss-cn-hangzhou.aliyuncs.com/h5/common/images/040101wuyouhui.png\">\r\n            <span style=\"margin-bottom: 2rem\" class=\"fsc_6\">暂无商品</span>\r\n            </div>`;\r\n    }\r\n    if(state==1){\r\n        dom.append(html);\r\n    }else{\r\n        dom.html(html);\r\n    }\r\n};\r\naddModel(goodsList,$('#initGoods'));\r\n// 获取categoryList数组\r\n\r\n// 获取页面尺寸\r\nvar windowW = $(window).outerWidth(),\r\n    page = 1; // 默认页数从1开始\r\n\r\n//导航滑动\r\nclass Swipe{\r\n    constructor(ele){\r\n        this.container = ele;\r\n        this.element = this.container.children[0];\r\n        this.distance=0;\r\n        this.length = this.element.children.length;\r\n        this.speed = 200;\r\n        //执行对象中的handleEvent函数\r\n        this.element.addEventListener(\"touchstart\", this);\r\n        this.element.addEventListener(\"touchmove\", this);\r\n    }\r\n    handleEvent(a) {\r\n        switch (a.type) {\r\n            case \"touchstart\":\r\n                this.onTouchStart(a);\r\n                break;\r\n            case \"touchmove\":\r\n                this.onTouchMove(a);\r\n                break;\r\n        }\r\n    }\r\n    onTouchStart(a) {\r\n        this.isScrolling = false;\r\n        this.deltaX = 0;\r\n        this.start = {\r\n            pageX: a.touches[0].pageX,\r\n            pageY: a.touches[0].pageY\r\n        };\r\n        this.element.style.MozTransitionDuration = this.element.style.webkitTransitionDuration = this.speed + \"ms\";\r\n        this.startDistance=this.distance;\r\n        a.stopPropagation()\r\n    }\r\n    onTouchMove(a) {\r\n        if (a.touches.length > 1 || a.scale && a.scale !== 1) {\r\n            return\r\n        }\r\n        this.deltaX = a.touches[0].pageX - this.start.pageX;\r\n        (Math.abs(this.deltaX) > Math.abs(a.touches[0].pageY - this.start.pageY))?this.isScrolling = true:this.isScrolling = false;   //判断横滚还是竖滚\r\n        if (this.isScrolling) {\r\n            this.distance=this.startDistance-this.deltaX;\r\n            if(this.distance<0){\r\n                this.distance=0\r\n            }else if(this.distance>this.element.clientWidth-windowW){\r\n                this.distance=this.element.clientWidth-windowW\r\n            }\r\n            this.element.style.left = -this.distance + \"px\";\r\n            a.stopPropagation()\r\n        }\r\n    }\r\n}\r\nnew Swipe(document.getElementById('navWrap'));\r\n\r\n// 导航tab切换\r\n$(function(){\r\n    // var mySwiper = new Swiper('.swiper-container', {        //tab切换\r\n    //     onSlideChangeStart: function(swiper) {\r\n    //         $(\".nav li\").eq(swiper.realIndex).click()\r\n    //     }\r\n    // });\r\n    let ulW = 0, // ul初始宽度  通过各个li宽度之和 计算出来\r\n        liWArr = []; // 保存每一个li的索引(index),自身宽度(width),距离ul左侧的距离(offsetLeft)\r\n\r\n        $(\".nav li\").each(function(index){\r\n        let thisLiW = $(this).outerWidth();\r\n        liWArr.push({\r\n            index: index,\r\n            width: thisLiW,\r\n            offsetLeft: ulW\r\n        });\r\n        ulW += thisLiW;\r\n    });\r\n    if ( ulW<windowW ) {\r\n        $(\".nav\").css(\"width\", windowW+\"px\");\r\n    }else{\r\n        $(\".nav\").css(\"width\", ulW+5+\"px\");\r\n    }\r\n    let typeCurrentNum = $(\"#typeCurrent\").val(); // 获取当前的type类型\r\n    let modelIdNum = getUrl(\"modelId\"); // 获取modelId参数\r\n\r\n    // 点击导航事件\r\n    $(\".nav li\").on('click',function(e){\r\n        e.preventDefault();\r\n        var i = $(this).index();\r\n        $(this).find(\"span\").addClass(\"current\");\r\n        $(this).siblings().find(\"span\").removeClass(\"current\");\r\n        let categoryObj = eval('(' + $(\"#categoryList\").val() + ')');\r\n        typeCurrentNum =  categoryObj[i].type;\r\n        var ulOffsetLeft = $(\".nav\").offset().left;\r\n        var thisLiOffsetUl = liWArr[i].offsetLeft;\r\n        var thisLiOffsetDiv = thisLiOffsetUl + ulOffsetLeft; //距离 边框的距离\r\n        var offsetLeft = ((windowW-liWArr[i].width)/2) - thisLiOffsetDiv;\r\n        var offset = ulOffsetLeft+offsetLeft;\r\n        if(offset >0){\r\n            offset = 0;\r\n        }else if(ulW<windowW){\r\n            offset = 0;\r\n        }else if(offset<windowW-ulW){\r\n            offset = windowW-ulW;\r\n        }\r\n        $(\".nav\").css({\"left\": offset + \"px\"});\r\n        $(\".swiper-slide\").hide();\r\n        $(\"div[data-type=\"+typeCurrentNum+\"]\").show();\r\n        var isUl = $(\"div[data-type=\"+typeCurrentNum+\"] .goodsListModel_mainContent\");\r\n        if(isUl.find('li').length<=0){\r\n            $.ajax({\r\n                url: \"/app/goods/categoryGoodsList\",\r\n                type: \"POST\",\r\n                dataType: \"JSON\",\r\n                data: {\r\n                    modelId : modelIdNum,\r\n                    pageNo: 1,\r\n                    type: typeCurrentNum\r\n                },\r\n                success: function(data){\r\n                    if (data.success) {\r\n                        addModel(data.data[\"goodsList\"],isUl);\r\n                    } else {\r\n                        requestMsg(data.msg);\r\n                    }\r\n                },\r\n                error: function(){\r\n                    requestMsg(\"请求失败\");\r\n                }\r\n            });\r\n        }\r\n    });\r\n    //滚动加载更多商品\r\n    $(window).on('scroll',function () {\r\n        if(finished==0){\r\n            var scrollTop = $(this).scrollTop();\r\n            var allHeight = $(document).height();\r\n            var windowHeight = $(this).height();\r\n            if (allHeight-windowHeight<=scrollTop+400) {\r\n                page++;\r\n                finished=1; //防止未加载完再次执行\r\n                $.ajax({\r\n                    url: \"/app/goods/categoryGoodsList\",\r\n                    type: \"POST\",\r\n                    dataType: \"JSON\",\r\n                    data: {\r\n                        modelId : modelIdNum,\r\n                        pageNo: page,\r\n                        type: typeCurrentNum\r\n                    },\r\n                    success: function(returnData){\r\n                        if (returnData.success) {\r\n                            if(returnData.data[\"goodsList\"]==\"\"){\r\n                                var txt='<div class=\"loadOver\"><span>没有更多了...</span></div>';\r\n                                $(\"div[data-type=\"+typeCurrentNum+\"]\").append(txt);\r\n                            }else{\r\n                                var goodsList = returnData.data[\"goodsList\"];\r\n                                addModel(goodsList,$(\"div[data-type=\"+typeCurrentNum+\"] .goodsListModel_mainContent\"),1);\r\n                                finished=0\r\n                            }\r\n                        } else {\r\n                            requestMsg(returnData.msg);\r\n                        }\r\n                        // pageNumber(page);\r\n                    },\r\n                    error: function(){\r\n                        requestMsg(\"请求失败\");\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    });\r\n\r\n});\r\n"]}
"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function handleScroll(){jQuery(window).scrollTop()>=207?jQuery("#navWrap").addClass("fixTop"):jQuery("#navWrap").removeClass("fixTop")}function couponClick(t,e,s,n){var a=t,i=e.index()/2,o=n;$.ajax({url:"/fanbei-web/pickCoupon",type:"POST",dataType:"JSON",data:{couponId:a},success:function(t){if(console.log(t),t.success){requestMsg("优惠劵领取成功");var e=parseInt($(".coupon").eq(i).attr("typeHas"));$(".coupon").eq(i).attr("typeHas",++e),e==o&&$(".coupon").eq(i).addClass("couponclose")}else{var s=t.data.status;"USER_NOT_EXIST"==s&&(window.location.href=t.url),"OVER"==s&&requestMsg(t.msg),"COUPON_NOT_EXIST"==s&&requestMsg(t.msg),"MORE_THAN"==s&&requestMsg(t.msg)}},error:function(){requestMsg("哎呀，出错了！")}})}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),finished=0,addModel=function(t,e,s){var n="";if(t.length>0){for(var a=0;a<t.length;a++){var i="",o=toDecimal2(t[a].saleAmount);if(1==t[a].goodsType){var r=" <span>¥"+t[a].nperMap.freeAmount+"</span>";0==t[a].nperMap.isFree&&(r=" <span>¥"+t[a].nperMap.amount+"</span>"),i='<div class="goodsListModel_mainContent_rebate clearfix">\n                        <span class="goodsListModel_rebate fl fs_22 fsc_f tac">月供</span>\n                        <p class="fl fs_24">\n                            '+r+'\n                            <span class="fs_22">起</span>\n                        </p>                \n                     </div>'}var d=notifyUrl+'&params={"goodsId":"'+t[a].goodsId+'"}';"SELFSUPPORT"==t[a].source&&(d=notifyUrl+'&params={"privateGoodsId":"'+t[a].goodsId+'"}'),n+='<li class="goodsListModel_item">\n                    <a href=\''+d+"'>\n                        <img src=\" "+t[a].goodsIcon+'" class="mainContent_img">\n                        <div class="goodsListModel_mainContent_wrap">\n                            <p class="fs_26 fsc_1">'+t[a].name+"</p>\n                            <p>                   \n                            <span>¥"+o+'</span>\n                                <span class="fsc_red fr"><i class="ba"></i>¥'+t[a].rebateAmount+"</span>\n                            </p>\n                        </div>\n                        "+i+"\n                    </a>\n                </li>"}finished=0}else n='<div class="nullPrompt">\n            <img src="http://51fanbei.oss-cn-hangzhou.aliyuncs.com/h5/common/images/040101wuyouhui.png">\n            <span style="margin-bottom: 2rem" class="fsc_6">暂无商品</span>\n            </div>';1==s?e.append(n):e.html(n)};addModel(goodsList,$("#initGoods"));var windowW=$(window).outerWidth(),page=1;2==getBlatFrom()?(window.addEventListener("touchstart",handleScroll),window.addEventListener("touchmove",handleScroll),window.addEventListener("touchend",handleScroll)):window.addEventListener("scroll",handleScroll);var Swipe=function(){function t(e){_classCallCheck(this,t),this.container=e,this.element=this.container.children[0],this.distance=0,this.length=this.element.children.length,this.speed=200,this.element.addEventListener("touchstart",this),this.element.addEventListener("touchmove",this)}return _createClass(t,[{key:"handleEvent",value:function(t){switch(t.type){case"touchstart":this.onTouchStart(t);break;case"touchmove":this.onTouchMove(t)}}},{key:"onTouchStart",value:function(t){this.isScrolling=!1,this.deltaX=0,this.start={pageX:t.touches[0].pageX,pageY:t.touches[0].pageY},this.element.style.MozTransitionDuration=this.element.style.webkitTransitionDuration=this.speed+"ms",this.startDistance=this.distance,t.stopPropagation()}},{key:"onTouchMove",value:function(t){t.touches.length>1||t.scale&&1!==t.scale||(this.deltaX=t.touches[0].pageX-this.start.pageX,Math.abs(this.deltaX)>Math.abs(t.touches[0].pageY-this.start.pageY)?this.isScrolling=!0:this.isScrolling=!1,this.isScrolling&&(this.distance=this.startDistance-this.deltaX,this.distance<0?this.distance=0:this.distance>this.element.clientWidth-windowW&&(this.distance=this.element.clientWidth-windowW),this.element.style.left=-this.distance+"px",t.stopPropagation()))}}]),t}();new Swipe(document.getElementById("navWrap")),$(function(){var t=0,e=[];$(".nav li").each(function(s){var n=$(this).outerWidth();e.push({index:s,width:n,offsetLeft:t}),t+=n}),t<windowW?$(".nav").css("width",windowW+"px"):$(".nav").css("width",t+5+"px");var s=getUrl("modelId");$(".nav li").on("click",function(n){n.preventDefault();var a=$(this).index();$(this).find("span").addClass("current"),$(this).siblings().find("span").removeClass("current"),typeCurrentNum=categoryList[a].type;var i=$(".nav").offset().left,o=e[a].offsetLeft,r=o+i,d=(windowW-e[a].width)/2-r,c=i+d;c>0?c=0:t<windowW?c=0:c<windowW-t&&(c=windowW-t),$(".nav").css({left:c+"px"}),$(".swiper-slide").hide(),$("div[data-type="+typeCurrentNum+"]").show();var l=$("div[data-type="+typeCurrentNum+"] .goodsListModel_mainContent");finished=0,l.find("li").length<=0?($(".current").attr("data-page",1),page=1,$.ajax({url:"/app/goods/categoryGoodsList",type:"POST",dataType:"JSON",data:{modelId:s,pageNo:1,type:typeCurrentNum},success:function(t){t.success?addModel(t.data.goodsList,l):requestMsg(t.msg)},error:function(){requestMsg("请求失败")}})):page=$(".current").attr("data-page")}),$(window).on("scroll",function(){if(0==finished&&!$(".current").attr("data-over")){var t=$(this).scrollTop();$(document).height()-$(this).height()<=t+400&&(page++,$(".current").attr("data-page",page),finished=1,$.ajax({url:"/app/goods/categoryGoodsList",type:"POST",dataType:"JSON",data:{modelId:s,pageNo:page,type:typeCurrentNum},success:function(t){if(t.success)if(""==t.data.goodsList){$("div[data-type="+typeCurrentNum+"]").append('<div class="loadOver"><span>没有更多了...</span></div>'),$(".current").attr("data-over","true")}else{var e=t.data.goodsList;addModel(e,$("div[data-type="+typeCurrentNum+"] .goodsListModel_mainContent"),1),finished=0}else requestMsg(t.msg)},error:function(){requestMsg("请求失败")}}))}})}),$(function(){$(".couponWrap").width(($(".coupon").width()+$(".kong").width())*$(".coupon").length),$(".kong").eq($(".coupon").length-1).hide()});
//# sourceMappingURL=../../_srcmap/js/goods/goodsListModel.js.map

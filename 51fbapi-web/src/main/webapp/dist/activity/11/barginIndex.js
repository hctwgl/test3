"use strict";var protocol=window.location.protocol,host=window.location.host,urlHost=protocol+"//"+host,goodsId="",goodsType="",userName=getUrl("userName"),vm=new Vue({el:"#barginIndex",data:{shareTime:0,totalData:{},firstGoods:{},ruleFlag:!1,downTime:{d:0,h:0,m:0,s:0},isWX:!1,pageNo:1,sureFlag:!1,goodsId:0,cutData:"",goodsType:"",url_3:"/activity/de/share"},created:function(){this.logData(),this.judge()},computed:{couponNum:function(){return this.firstGoods.couponList?this.firstGoods.couponList.filter(function(e,o){return 0!=e.state}).length:0}},methods:{judge:function(){"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?(this.isWX=!0,this.url_3="/activityH5/de/share"):this.isWX=!1},logData:function(){var e=this;$.ajax({url:"/activity/de/goods",type:"POST",dataType:"json",success:function(o){if(!o.success)return requestMsg("哎呀，出错了！"),!1;e.totalData=o.data,e.getFirstData(),e.countDown(),e.getShareTimes(),$(".loadingMask").fadeOut()},error:function(){requestMsg("哎呀，出错了！")}})},getFirstData:function(){for(var e=this,o=e.totalData.goodsList,t=o.length-1;t>=0;t--)if(1==o[t].type){e.firstGoods=o[t];break}},getShareTimes:function(){var e=this,o=e.totalData.goodsList;console.dir(e.totalData,e.shareTime);for(var t=0;t<o.length;t++)1==o[t].share&&1!=o[t].type&&e.shareTime++},showRule:function(){this.ruleFlag=!0},closeRule:function(){this.ruleFlag=!1},closeSure:function(){this.sureFlag=!1},share:function(e,o){goodsId=e,goodsType=o;var t=this;$.ajax({url:t.url_3,type:"POST",dataType:"json",data:{goodsPriceId:e},success:function(e){if(console.log("share=",e),!e.success)return e.hasOwnProperty("data")?t.isWX?location.href="./barginLogin?goodsId="+goodsId:location.href=e.data.loginUrl:requestMsg("只能砍价两件商品，不要太贪心哦"),!1;if("product"==o){if(t.shareTime>=2)return requestMsg("只能砍价两件商品，不要太贪心哦"),!1;t.sureFlag=!0}else t.shareSure()},error:function(){requestMsg("哎呀，出错了！")}})},shareSure:function(){if(this.sureFlag=!1,this.isWX)requestMsg("请点击右上角进行分享");else{var e={shareAppTitle:"51返呗邀请有礼，快来参与~",shareAppContent:"我知道一个反利APP，购物不仅返现，邀请好友也赚钱哦~",shareAppImage:"https://f.51fanbei.com/h5/common/icon/midyearCorner.png",shareAppUrl:urlHost+"/fanbei-web/activity/barginProduct?goodsId="+goodsId+"&productType=share"+goodsType+"&userName="+getInfo().userName,isSubmit:"Y",sharePage:"barginIndex"};e=JSON.stringify(e);var o=BASE64.encoder(e);window.location.href="/fanbei-web/opennative?name=APP_SHARE&params="+o}},toList:function(e){location.href="/fanbei-web/activity/barginList?goodsId="+e},toProduct:function(e,o){var t=userName||getInfo().userName;location.href="/fanbei-web/activity/barginProduct?goodsId="+e+"&productType="+o+"&userName="+t},countDown:function(){var e=this;setInterval(function(){var o=(e.totalData.endTime-(new Date).getTime())/1e3,t=0,s=0,a=0,r=0;o>=0&&(t=Math.floor(o/60/60/24),s=Math.floor(o/60/60%24),a=Math.floor(o/60%60),r=Math.floor(o%60)),e.downTime.d=t,e.downTime.h=s,e.downTime.m=a,e.downTime.s=r},1e3)},couponClick:function(e){var o=this,t=e.couponId;$.ajax({url:"/fanbei-web/pickCoupon",type:"POST",dataType:"JSON",data:{couponId:t},success:function(e){if(console.log("假装领取了优惠券。couponClickReturn=",e),e.success)requestMsg("优惠劵领取成功");else{var t=e.data.status;"USER_NOT_EXIST"==t&&(o.isWX?requestMsg("哎呀，出错了！"):window.location.href=e.url),"OVER"==t&&requestMsg("您已经领取，快去使用吧"),"COUPON_NOT_EXIST"==t&&requestMsg(e.msg),"MORE_THAN"==t&&requestMsg(e.msg)}},error:function(){requestMsg("哎呀，出错了！")}})},buy:function(){this.isWX?location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.alfl.www":window.location.href='/fanbei-web/opennative?name=GOODS_DETAIL_INFO&params={"privateGoodsId":"'+goodsId+'"}'}}});
//# sourceMappingURL=../../_srcmap/activity/11/barginIndex.js.map

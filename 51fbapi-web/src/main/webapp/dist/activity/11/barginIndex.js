"use strict";function setShareType(){return goodsType}var protocol=window.location.protocol,host=window.location.host,urlHost=protocol+"//"+host,goodsId="",goodsType="",userName=getUrl("userName"),spread=getUrl("spread"),vm=new Vue({el:"#barginIndex",data:{shareTime:0,totalData:{},firstGoods:{},ruleFlag:!1,downTime:{d:0,h:0,m:0,s:0},isWX:!1,pageNo:1,sureFlag:!1,shareFlag:!1,goodsId:0,cutData:"",goodsType:"",url_3:"/activity/de/share",url_1:"/activity/de/goods",url_2:"/fanbei-web/pickCoupon",couponData:[],ajaxFlag:!0},created:function(){this.judge(),this.maidian()},computed:{couponNum:function(){return this.firstGoods.couponList?this.firstGoods.couponList.filter(function(e,a){return 0!=e.state}).length:0}},methods:{judge:function(){"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?(this.isWX=!0,this.url_3="/activityH5/de/share",this.url_1="/activityH5/de/goods",this.url_2="/activityH5/de/pickCoupon"):this.isWX=!1,this.logData()},logData:function(){var e=this;$.ajax({url:e.url_1,type:"POST",dataType:"json",success:function(a){if(!a.success)return requestMsg("哎呀，出错了！"),!1;e.totalData=a.data,e.getFirstData(),e.countDown(),e.getShareTimes(),$(".loadingMask").fadeOut()},error:function(){requestMsg("哎呀，出错了！")}})},getFirstData:function(){for(var e=this,a=e.totalData.goodsList,t=a.length-1;t>=0;t--)if(1==a[t].type){e.firstGoods=a[t],e.couponData=a[t].couponList;break}},getShareTimes:function(){var e=this,a=e.totalData.goodsList;console.dir(e.totalData,e.shareTime);for(var t=0;t<a.length;t++)1==a[t].share&&1!=a[t].type&&e.shareTime++},showRule:function(){this.ruleFlag=!0},closeRule:function(){this.ruleFlag=!1},closeSure:function(){this.sureFlag=!1},closeShare:function(){this.shareFlag=!1},share:function(e,a,t){goodsId=e,goodsType=a,shareInfo.link=urlHost+"/fanbei-web/activity/barginProduct?goodsId="+goodsId+"&productType=share"+goodsType+"&userName="+userName+"&spread="+spread;var o=this;if(1==t)o.shareSure();else if("product"==a){if(o.shareTime>=5)return requestMsg("只能砍价五件商品，不要太贪心哦"),!1;o.sureFlag=!0}else o.shareFn()},shareFn:function(){var e=this;e.sureFlag=!1,e.ajaxFlag&&(e.ajaxFlag=!1,$.ajax({url:e.url_3,type:"POST",dataType:"json",data:{goodsPriceId:goodsId},success:function(a){if(!a.success)return a.hasOwnProperty("data")?e.isWX?location.href="./barginLogin?&spread="+spread:location.href=a.data.loginUrl:requestMsg(a.msg),!1;e.shareSure()},error:function(){requestMsg("哎呀，出错了！")},complete:function(){e.ajaxFlag=!0}}))},shareSure:function(){if(this.sureFlag=!1,this.isWX)this.shareFlag=!0;else{var e={shareAppTitle:"砍价赢免单丨iphone X0元免费领!",shareAppContent:"来不及解释啦，爱上街想送你iphone X，还差一点点，请帮我砍它~",shareAppImage:"http://f.51fanbei.com/online/17f31c95deb17587.png",shareAppUrl:urlHost+"/fanbei-web/activity/barginProduct?goodsId="+goodsId+"&productType=share"+goodsType+"&userName="+getInfo().userName+"&spread="+spread,isSubmit:"Y",sharePage:"barginIndex"};e=JSON.stringify(e);var a=BASE64.encoder(e);window.location.href="/fanbei-web/opennative?name=APP_SHARE&params="+a}},toList:function(e){location.href="/fanbei-web/activity/barginList?goodsId="+e},toProduct:function(e,a){var t=userName||getInfo().userName;location.href="/fanbei-web/activity/barginProduct?goodsId="+e+"&productType="+a+"&userName="+t+"&spread="+spread},countDown:function(){var e=this;setInterval(function(){var a=(e.totalData.endTime-(new Date).getTime())/1e3,t=0,o=0,s=0,r=0;a>=0&&(t=Math.floor(a/60/60/24),o=Math.floor(a/60/60%24),s=Math.floor(a/60%60),r=Math.floor(a%60)),e.downTime.d=t,e.downTime.h=o,e.downTime.m=s,e.downTime.s=r},1e3)},couponClick:function(e,a){var t=this,o=e.couponId;2==e.state?t.ajaxFlag&&(t.ajaxFlag=!1,$.ajax({url:t.url_2,type:"POST",dataType:"JSON",data:{couponId:o},success:function(e){if(e.success)requestMsg("优惠劵领取成功"),t.$set(t.couponData[a],"state",1);else{var o=e.data.status;"USER_NOT_EXIST"==o&&(t.isWx?location.href="./barginLogin":window.location.href=e.url),"OVER"==o&&requestMsg("您已经领取，快去使用吧"),"COUPON_NOT_EXIST"==o&&requestMsg(e.msg),"MORE_THAN"==o&&requestMsg(e.msg)}},error:function(){requestMsg("哎呀，出错了！")},complete:function(){t.ajaxFlag=!0}})):1==e.state&&requestMsg("您已经领取，快去使用吧")},buy:function(e){this.isWX?location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.alfl.www":window.location.href='/fanbei-web/opennative?name=GOODS_DETAIL_INFO&params={"privateGoodsId":"'+e+'"}'},maidian:function(e){$.ajax({url:"/fanbei-web/postMaidianInfo",type:"post",data:{maidianInfo:"/fanbei-web/activity/barginIndex?userName="+userName,spread:spread},success:function(e){console.log(e)}})}}});
//# sourceMappingURL=../../_srcmap/activity/11/barginIndex.js.map

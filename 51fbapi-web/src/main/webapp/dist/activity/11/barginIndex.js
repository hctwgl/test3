"use strict";var protocol=window.location.protocol,host=window.location.host,urlHost=protocol+"//"+host,goodsId="",goodsType="",userName=getUrl("userName"),vm=new Vue({el:"#barginIndex",data:{shareTime:0,totalData:{},firstGoods:{},ruleFlag:!1,downTime:{d:0,h:0,m:0,s:0},isWX:!1,pageNo:1,sureFlag:!1,shareFlag:!1,goodsId:0,cutData:"",goodsType:"",url_3:"/activity/de/share",url_1:"/activity/de/goods",url_2:"/fanbei-web/pickCoupon",couponData:[]},created:function(){this.judge()},computed:{couponNum:function(){return this.firstGoods.couponList?this.firstGoods.couponList.filter(function(t,e){return 0!=t.state}).length:0}},methods:{judge:function(){"micromessenger"==window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?(this.isWX=!0,this.url_3="/activityH5/de/share",this.url_1="/activityH5/de/goods",this.url_2="/activityH5/de/pickCoupon"):this.isWX=!1,this.logData()},logData:function(){var t=this;$.ajax({url:t.url_1,type:"POST",dataType:"json",success:function(e){if(!e.success)return requestMsg("哎呀，出错了！"),!1;t.totalData=e.data,t.getFirstData(),t.countDown(),t.getShareTimes(),$(".loadingMask").fadeOut()},error:function(){requestMsg("哎呀，出错了！")}})},getFirstData:function(){for(var t=this,e=t.totalData.goodsList,o=e.length-1;o>=0;o--)if(1==e[o].type){t.firstGoods=e[o],t.couponData=e[o].couponList;break}},getShareTimes:function(){var t=this,e=t.totalData.goodsList;console.dir(t.totalData,t.shareTime);for(var o=0;o<e.length;o++)1==e[o].share&&1!=e[o].type&&t.shareTime++},showRule:function(){this.ruleFlag=!0},closeRule:function(){this.ruleFlag=!1},closeSure:function(){this.sureFlag=!1},closeShare:function(){this.shareFlag=!1},share:function(t,e){goodsId=t,goodsType=e;var o=this;$.ajax({url:o.url_3,type:"POST",dataType:"json",data:{goodsPriceId:t},success:function(t){if(!t.success)return t.hasOwnProperty("data")?o.isWX?location.href="./barginLogin?goodsId="+goodsId:location.href=t.data.loginUrl:"product"==e&&requestMsg("只能砍价两件商品，不要太贪心哦"),!1;if("product"==e){if(o.shareTime>=2)return requestMsg("只能砍价两件商品，不要太贪心哦"),!1;o.sureFlag=!0}else o.shareSure()},error:function(){requestMsg("哎呀，出错了！")}})},shareSure:function(){if(this.sureFlag=!1,this.isWX)this.shareFlag=!0;else{var t={shareAppTitle:"51返呗邀请有礼，快来参与~",shareAppContent:"我知道一个反利APP，购物不仅返现，邀请好友也赚钱哦~",shareAppImage:"https://f.51fanbei.com/h5/common/icon/midyearCorner.png",shareAppUrl:urlHost+"/fanbei-web/activity/barginProduct?goodsId="+goodsId+"&productType=share"+goodsType+"&userName="+getInfo().userName,isSubmit:"Y",sharePage:"barginIndex"};t=JSON.stringify(t);var e=BASE64.encoder(t);window.location.href="/fanbei-web/opennative?name=APP_SHARE&params="+e}},toList:function(t){location.href="/fanbei-web/activity/barginList?goodsId="+t},toProduct:function(t,e){var o=userName||getInfo().userName;location.href="/fanbei-web/activity/barginProduct?goodsId="+t+"&productType="+e+"&userName="+o},countDown:function(){var t=this;setInterval(function(){var e=(t.totalData.endTime-(new Date).getTime())/1e3,o=0,a=0,s=0,i=0;e>=0&&(o=Math.floor(e/60/60/24),a=Math.floor(e/60/60%24),s=Math.floor(e/60%60),i=Math.floor(e%60)),t.downTime.d=o,t.downTime.h=a,t.downTime.m=s,t.downTime.s=i},1e3)},couponClick:function(t,e){var o=this,a=t.couponId;2==t.state&&$.ajax({url:o.url_2,type:"POST",dataType:"JSON",data:{couponId:a},success:function(t){if(t.success)requestMsg("优惠劵领取成功"),o.couponData[e].state;else{var a=t.data.status;"USER_NOT_EXIST"==a&&(o.isWx?location.href="./barginLogin":window.location.href=t.url),"OVER"==a&&requestMsg("您已经领取，快去使用吧"),"COUPON_NOT_EXIST"==a&&requestMsg(t.msg),"MORE_THAN"==a&&requestMsg(t.msg)}},error:function(){requestMsg("哎呀，出错了！")}})},buy:function(t){this.isWX?location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.alfl.www":window.location.href='/fanbei-web/opennative?name=GOODS_DETAIL_INFO&params={"privateGoodsId":"'+t+'"}'}}});
//# sourceMappingURL=../../_srcmap/activity/11/barginIndex.js.map

<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ald.fanbei.api.dal.dao.AfUserAccountDao">
	<sql id="queryAllFields">
		id rid,user_id,user_name,au_amount,used_amount,freeze_amount,
		score,alipay_account,rebate_amount,id_number,jfb_amount,password,salt,fail_count,uc_amount,bind_card,repayment_amount
	</sql>
	
	<sql id="queryWithUserFields">
		c.id rid,c.user_id,c.user_name,c.au_amount,c.used_amount,c.freeze_amount,
		c.score,c.alipay_account,c.rebate_amount,c.id_number,c.jfb_amount,c.uc_amount,u.gender,u.nick,u.avatar,
		u.real_name,u.mobile,u.recommend_code,c.repayment_amount
	</sql>
	
	<select id="getUserAccountInfoByUserId" resultType="AfUserAccountDo" >
		SELECT 
			<include refid="queryAllFields" />
		FROM 
			af_user_account
		WHERE
			is_delete = 0 
		AND
			user_id = #{userId}	
	</select>

	<insert id="addUserAccount" parameterType="AfUserAccountDo" useGeneratedKeys="true" >
		INSERT INTO
			af_user_account
			(
				user_id,
				user_name
			)
		VALUES
			(
				#{userId},
				#{userName}
			)
	</insert>
	
	<update id="updateUserAccount" parameterType="AfUserAccountDo" >
		UPDATE af_user_account SET gmt_modified = NOW()
			<if test="userName != null">
    			,user_name=#{userName}
			</if>
			<if test="auAmount != null">
    			,au_amount=au_amount + #{auAmount}
			</if>
			<if test="usedAmount != null">
    			,used_amount=used_amount + #{usedAmount}
			</if>
			<if test="freezeAmount != null">
    			,freeze_amount=freeze_amount + #{freezeAmount}
			</if>
			<if test="score != null">
    			,score=#{score}
			</if>
			<if test="alipayAccount != null">
    			,alipay_account=#{alipayAccount}
			</if>
			<if test="rebateAmount != null">
    			,rebate_amount=rebate_amount + #{rebateAmount}
			</if>
			<if test="idNumber != null">
    			,id_number=#{idNumber}
			</if>
			<if test="realName != null">
    			,real_name=#{realName}
			</if>
			<if test="jfbAmount != null">
    			,jfb_amount=jfb_amount + #{jfbAmount}
			</if>
			<if test="password != null">
    			,password=#{password}
			</if>
			<if test="salt != null">
    			,salt=#{salt}
			</if>
			<if test="failCount != null">
    			,fail_count=#{failCount}
			</if>
			<if test="ucAmount != null">
    			,uc_amount=uc_amount + #{ucAmount}
			</if>
			<if test="bindCard != null">
    			,bind_card=#{bindCard}
			</if>
			<if test="repaymentAmount != null">
    			,repayment_amount=#{repaymentAmount}
			</if>
		WHERE user_id = #{userId}
	</update>

	<select id="getUserAndAccountByUserId" parameterType="java.lang.Long" resultType="AfUserAccountDto">
		SELECT 
			<include refid="queryWithUserFields" />
		FROM 
			af_user u
		LEFT JOIN
			af_user_account c
		ON
			c.is_delete = 0 and u.id = c.user_id
		WHERE
			u.is_delete = 0 
		AND
			u.id = #{userId}	
	</select>

</mapper>
<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ald.fanbei.api.dal.dao.AfUserAccountDao">
	<sql id="queryAllFields">
		id rid,user_id,user_name,au_amount,remaining_amount,used_amount,freeze_amount,
		score,alipay_account,commission,id_number,rebate_amount
	</sql>
	
	<sql id="queryWithUserFields">
		c.id rid,c.user_id,c.user_name,c.au_amount,c.remaining_amount,c.used_amount,c.freeze_amount,
		c.score,c.alipay_account,c.commission,c.id_number,c.rebate_amount,u.gender,u.nick,u.avata,
		u.real_name,u.mobile,u.vip_level,u.recommend_code
	</sql>
	
	<select id="getUserAccountInfoByUserId" parameterType="AfUserAccountDo">
		SELECT 
			<include refid="queryAllFields" />
		FROM 
			af_user_account
		WHERE
			is_delete = 0 
		AND
			user_id = #{userId}	
	</select>

	<insert id="addUserAccount" parameterType="AfUserAccountDo" useGeneratedKeys="true" >
		INSERT INTO
			af_user_account
			(
				user_id,
				user_name
			)
		VALUES
			(
				#{userId},
				#{userName}
			)
	</insert>
	
	<update id="updateUserAccount" parameterType="AfUserAccountDo">
		UPDATE
			af_user_account
		SET
			is_delete = 0
		<if test="userId != null">
			, userId = #{userId}
		</if>
		<if test="userName != null">
			, user_name = #{userName}
		</if>
		<if test="auAmount != null">
			, au_amount = #{auAmount}
		</if>
		<if test="remainingAmount != null">
			, remaining_amount = #{remainingAmount}
		</if>
		<if test="usedAmount != null">
			, used_amount = #{usedAmount}
		</if>
		<if test="freezeAmount != null">
			, freeze_amount = #{freezeAmount}
		</if>
		<if test="score != null">
			, score = #{score}
		</if>
		<if test="alipayAccount != null">
			, alipay_account = #{alipay_account}
		</if>
		<if test="commission != null">
			, commission = #{commission}
		</if>
		<if test="idNumber != null">
			, id_number = #{idNumber}
		</if>
		<if test="rebateAmount != null">
			, rebate_amount = #{rebateAmount}
		</if>
		WHERE
			is_delete = 0
		AND
			id = #{rid}
	</update>

	<select id="getUserAndAccountByUserId" parameterType="java.lang.Long" resultType="AfUserAccountDto">
		SELECT 
			<include refid="queryWithUserFields" />
		FROM 
			af_user u
		LEFT JOIN
			af_user_account c
		ON
			c.is_delete = 0 and u.id = c.user_id
		WHERE
			u.is_delete = 0 
		AND
			u.id = #{userId}	
	</select>

</mapper>
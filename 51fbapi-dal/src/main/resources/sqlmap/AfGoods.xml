<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ald.fanbei.api.dal.dao.AfGoodsDao">
	<sql id="queryFields">
		id rid,gmt_create,gmt_modified,creator,modifier,name,goods_icon,thumbnail_icon,goods_url,open_id,num_id,price_amount,
		sale_amount,category_id,sale_count,gmt_start,gmt_end,status,source,rebate_amount,rebate_rate,shop_name,
		(sale_amount-rebate_amount) real_amount,tags,goods_pic1,goods_pic2,goods_pic3,goods_pic4,goods_detail,remark,stock_count,primary_category_id,brand_id
	</sql>

	<sql id="queryItemFields">
		b.id rid,a.gmt_create,b.gmt_modified,b.creator,b.modifier,b.name,b.goods_icon,b.thumbnail_icon,b.goods_url,b.open_id,b.num_id,b.price_amount,
		b.sale_amount,b.category_id,b.sale_count,b.gmt_start,b.gmt_end,b.status,b.source,b.rebate_amount,b.rebate_rate,b.shop_name,
		(b.sale_amount-b.rebate_amount) real_amount,b.tags,b.goods_pic1,b.goods_pic2,b.goods_pic3,b.goods_pic4,b.goods_detail,b.remark,b.stock_count,b.primary_category_id
	</sql>

	<sql id="queryAllFields">
		a.id rid,a.gmt_create,a.gmt_modified,a.creator,a.modifier,a.name,a.goods_icon,a.thumbnail_icon,a.goods_url,a.open_id,a.num_id,a.price_amount,
		a.sale_amount,a.category_id,a.sale_count,a.gmt_start,a.gmt_end,a.status,a.source,a.rebate_amount,a.rebate_rate,a.shop_name,
		(a.sale_amount-a.rebate_amount) real_amount,a.tags,a.goods_pic1,a.goods_pic2,a.goods_pic3,a.goods_pic4,a.goods_detail,a.remark,a.stock_count
	</sql>

	<sql id="queryFlashFields">
		id rid,s.gmt_create,gmt_modified,creator,modifier,name,goods_icon,thumbnail_icon,goods_url,open_id,num_id,price_amount,
		sale_amount,category_id,sale_count,gmt_start,gmt_end,status,source,rebate_amount,rebate_rate,shop_name,
		(sale_amount-rebate_amount) real_amount,tags,goods_pic1,goods_pic2,goods_pic3,goods_pic4,goods_detail,remark,stock_count
	</sql>
	
	<sql id="queryWithFields">
		g.id rid,g.gmt_create,g.gmt_modified,g.creator,g.modifier,g.name,g.goods_icon,g.thumbnail_icon,g.goods_url,g.open_id,g.num_id,g.price_amount,
		g.sale_amount,g.category_id,g.sale_count,g.gmt_start,g.gmt_end,g.status,g.source,g.rebate_amount,g.rebate_rate,g.shop_name,
		(g.sale_amount-g.rebate_amount) real_amount,g.tags,g.goods_pic1,g.goods_pic2,g.goods_pic3,g.goods_pic4,g.goods_detail,g.remark
	</sql>

    <resultMap id="leaseResultMap" type="com.ald.fanbei.api.dal.domain.dto.LeaseGoods">
		<id column="rid" property="rid" jdbcType="BIGINT" />
        <collection select="getByGoodsId" property="goodsPrice" column="rid" ofType="AfGoodsPriceDo">
        </collection>
    </resultMap>

    <select id="getGoodsById" resultType="AfGoodsDo">
		SELECT
			<include refid="queryFields"/>
		FROM
			af_goods
		WHERE
			is_delete=0 AND id = #{rid}
	</select>
	
	<select id="getGoodsByNumId" resultType="AfGoodsDo">
		SELECT
			<include refid="queryFields"/>
		FROM
			af_goods
		WHERE
			is_delete=0 AND num_id = #{numId}  limit 1
	</select>
	
	
	
	<select id="getGoodsByOpenId" resultType="AfGoodsDo">
		SELECT
			<include refid="queryFields"/>
		FROM
			af_goods
		WHERE
			is_delete=0 AND open_id=#{openId}
		order by gmt_modified desc limit 1
	</select>
	
	<select id="getCateGoodsList" resultType="AfGoodsDo" parameterType="AfGoodsQuery">
		SELECT
			<include refid="queryWithFields"/>
		FROM
			af_goods g
		WHERE
			g.is_delete=0  and g.status = 'PUBLISH'
			<if test="categoryId != null and categoryId !=0">
				and g.primary_category_id=#{categoryId}
			</if>
			<if test="categoryId == null or categoryId ==0">
				and exists(select 1 from af_category c where c.is_delete=0 and c.level=1 and g.primary_category_id=c.id) 
			</if>
			<if test="keywords != null and keywords !=''">
				AND g.name LIKE CONCAT('%',#{keywords}, '%')
			</if>
			<if test="minAmount != null and minAmount !=0">
				AND (g.sale_amount-g.rebate_amount)>=#{minAmount}
			</if>
			<if test="maxAmount != null and maxAmount !=0">
				AND (g.sale_amount-g.rebate_amount)<![CDATA[  <=  ]]> #{maxAmount}
			</if>
			<if test="source != null and source !=''">
				AND g.source = #{source}
			</if>
			<if test="appVersion != null and 371 > appVersion">
				AND
					id <![CDATA[  <=  ]]> 110552
			</if>
			<if test="appVersion != null and  appVersion >= 371">
				AND
					id <![CDATA[  >  ]]> 10552
			</if>
		order by g.gmt_modified desc
	</select>
	
	
	
	<select id="getHomeCategoryGoodsList" resultType="AfGoodsDo" parameterType="AfGoodsQuery">
		SELECT
			<include refid="queryWithFields"/>
		FROM
			af_goods g
		WHERE
			g.is_delete=0  and g.status = 'PUBLISH'
			<if test="categoryId != null and categoryId !=0">
				and g.category_id=#{categoryId}
			</if>
			<if test="categoryId == null or categoryId ==0">
				and exists(select 1 from af_category c where c.is_delete=0 and c.level=1 and g.primary_category_id=c.id) 
			</if>
		order by g.gmt_modified desc
	</select>
	
	<update id="updateSubscribeStatus">
		UPDATE
			af_goods
		SET
			gmt_modified = NOW(),
			modifier = 'system',
			subscribe = #{status}
			<if test="publishStatus != null and  publishStatus != ''">
				 ,status = #{publishStatus}
			</if>
		WHERE
			num_id = #{numId}
	</update>
	
	<update id="updateTaobaoGoodsInfo" parameterType="AfGoodsDo" >
		UPDATE
			af_goods
		SET
			gmt_modified = NOW()
			,modifier = 'system'
			<if test="name != null and name != ''">
				,name = #{name}
			</if>
			<!-- 禁止修改商品图片 -->
			<!-- 
			<if test="goodsIcon != null and goodsIcon != ''">
				,goods_icon = #{goodsIcon}
			</if>
			 -->
			<if test="priceAmount != null">
				,price_amount = #{priceAmount}
			</if>
			<if test="saleAmount != null">
				,sale_amount = #{saleAmount}
			</if>
		WHERE
			num_id = #{numId}
	</update>
	
	<update id="cancelPublishGoods">
		UPDATE
			af_goods
		SET
			gmt_modified = NOW(),
			modifier = 'system',
			status = 'CANCEL'
		WHERE
			num_id = #{numId}
	</update>
	<update id="updateSelfSupportGoods">
		UPDATE
			af_goods
		SET
			gmt_modified = NOW(),
			
			sale_count = sale_count+#{addSaleCount}
		WHERE
			is_delete=0 AND
			id = #{rid}
	</update>
	
	<select id="checkIsSelfBuild"  resultType="AfGoodsDo">
		SELECT
			<include refid="queryFields"/>
		FROM af_goods
		WHERE is_delete = 0
		AND source = 'SELFBUILD'
		AND is_grab_success = 0
		AND num_id = #{numId}
	</select>
	<select id="listGoodsListByParentIdAndFormerCategoryId"  resultType="AfGoodsDo" parameterType="java.lang.Long">
		SELECT
			<include refid="queryFields"/>
		FROM af_goods
		WHERE is_delete = 0
		AND STATUS = 'PUBLISH'
		AND primary_category_id = #{parentId}
		AND category_id = (
				SELECT 
				 id 
			    FROM af_goods_category 
				WHERE parent_id =(          
						SELECT
						id 
						FROM af_goods_category 
						WHERE parent_id = #{parentId}
						AND LEVEL = 2
					
						ORDER BY sort DESC 
						LIMIT 0,1
				)
		AND LEVEL = 3
		ORDER BY sort DESC 
		LIMIT 0,1
	 )
	</select>
	
	<select id="listGoodsListByParentIdFromSubjectGoods"  resultType="AfGoodsDo" parameterType="java.lang.Long">
			 	select 
					<include refid="queryFields"/>
					FROM af_goods g
						 inner join 
						(
							  SELECT 
								 goods_id 
								FROM af_subject_goods 
								WHERE subject_id =(          
										SELECT
										min(id) id
										FROM af_subject 
										WHERE parent_id = #{parentId}
										AND LEVEL = 2
								)
								AND parent_subject_id = #{parentId}
								and is_delete  = 0
			
						)as asg
						on asg.goods_id = g.id
						and g.is_delete = 0
						and g.status = 'PUBLISH'
 			
	</select>		
				
				
				
	
	<select id="listGoodsListByPrimaryCategoryIdAndCategoryId"  resultType="AfGoodsDo" parameterType="java.lang.Long">
		SELECT
			<include refid="queryFields"/>
		FROM af_goods
		WHERE is_delete = 0
		AND STATUS = 'PUBLISH'
		AND primary_category_id = #{primaryCategoryId}
		AND category_id = #{categoryId}
	</select>

	<select id="selectFlashSaleGoods" resultType="AfEncoreGoodsDto" parameterType="AfGoodsQuery" >
		SELECT
		<include refid="queryFlashFields"/>
		FROM
			(
				SELECT
					m.goods_id,m.gmt_create
				FROM
					af_activity_model m,
					(
						SELECT
							id
						FROM
							af_activity
						WHERE
							is_delete = 0
						AND type = '7'
						AND `status` = '2'
						AND gmt_start = CAST(CAST(SYSDATE()AS DATE)AS DATETIME)
					) a
				WHERE
					a.id = m.activity_id
				AND m.is_delete = 0
				AND m.goods_type = 3
			) s
		LEFT JOIN af_goods g ON s.goods_id = g.id
		WHERE
			g.is_delete = 0
		AND g.status = 'PUBLISH'
		ORDER BY s.gmt_create desc
	</select>

	<select id="selectBookingRushGoods" resultType="AfEncoreGoodsDto" parameterType="AfGoodsQuery" >
		SELECT
		<include refid="queryFields"/>
		FROM
		(
		SELECT
		m.goods_id
		FROM
		af_activity_model m,
		(
		SELECT
		id
		FROM
		af_activity
		WHERE
		is_delete = 0
		AND type = '7'
		AND `status` = '2'
		AND gmt_start = date_add(CAST(CAST(SYSDATE()AS DATE)AS DATETIME), interval 1 day)
		) a
		WHERE
		a.id = m.activity_id
		AND m.is_delete = 0
		AND m.goods_type = 3
		) s
		LEFT JOIN af_goods g ON s.goods_id = g.id
		WHERE
			g.is_delete = 0
		AND g.status = 'PUBLISH'
		ORDER BY g.gmt_create desc
	</select>


	<select id="getGoodsByCategoryId" resultType="AfGoodsDo">
		SELECT
			<include refid="queryFields"/>
		FROM af_goods
		WHERE 
			is_delete = 0
		AND
			category_id = #{categoryId}
		LIMIT 50
	</select>

	<select id="getGoodsByItem" resultType="AfGoodsDo">
		SELECT
			<include refid="queryItemFields"/>
		FROM af_model_h5_item a,af_goods b
		where `item_value2` = #{categoryId}
		and a.item_type = 'GOODS_ID'
		and a.type = 'GOODSLIST'
		and a.item_value = b.id
		and a.is_delete = 0
		and b.is_delete = 0 and b.status='PUBLISH' order by a.gmt_create desc LIMIT 50
	</select>


	<select id="listGoodsListBySubjectId" resultType="AfGoodsDo" parameterType="java.lang.Long">
		select 
				g.id rid,g.gmt_create,g.gmt_modified,g.creator,g.modifier,g.name,g.goods_icon,g.thumbnail_icon,g.goods_url,g.open_id,g.num_id,g.price_amount,
		g.sale_amount,g.category_id,g.sale_count,g.gmt_start,g.gmt_end,g.status,g.source,g.rebate_amount,g.rebate_rate,g.shop_name,
		(g.sale_amount-g.rebate_amount) real_amount,g.tags,g.goods_pic1,g.goods_pic2,g.goods_pic3,g.goods_pic4,g.goods_detail,g.remark,g.stock_count
		
		from af_goods g 
		inner join af_subject_goods sg
		on sg.`goods_id`  = g.id  
		and sg.`subject_id`  = #{subjectId}
		and sg.`is_delete` = 0 
		and g.`is_delete`  = 0
		and g.status = 'PUBLISH'	
	</select>
		<select id="getGoodsByModelId" resultType="AfGoodsDo">
		SELECT
			<include refid="queryFields"/>
		from af_goods
		where is_delete = 0
		AND
			id in (select item_value from af_model_h5_item where item_value2 = #{categoryId} and item_type = 'GOODS_ID' and type = 'GOODSLIST' and is_delete = 0)

	</select>
	<select id="getHomeGoodsByModelId" resultType="AfGoodsDo">
		SELECT
		<include refid="queryAllFields"/>
		FROM
		af_goods a LEFT JOIN af_model_h5_item b on b.item_value = a.id
		WHERE
		a.is_delete = 0 AND a.`status` = 'PUBLISH'
		AND b.item_value2 = #{categoryId}
		AND b.item_type = 'GOODS_ID'
		AND b.type = 'GOODSLIST'
		AND b.is_delete = 0
		ORDER BY b.gmt_create desc

	</select>

	<select id="getGoodsVerifyByCategoryId" resultType="AfGoodsDo">
		select
			g.source,g.rebate_amount,g.rebate_rate,g.id Rid,g.name,g.goods_icon,g.goods_url,g.num_id,g.price_amount,g.sale_amount,g.sale_count,v.gmt_create,g.goods_pic1
		from af_goods_verify v,af_goods g
		where g.is_delete =0 and v.is_delete =0 and g.id = v.goods_id
		and g.category_id = #{categoryId} and g.source = 'SELFSUPPORT' and  g.status = 'PUBLISH' order by v.gmt_create DESC
	</select>

	<select id="getGoodsVerifyByCategoryIdAndVolume" resultType="com.ald.fanbei.api.dal.domain.dto.HomePageSecKillGoods" parameterType="com.ald.fanbei.api.dal.domain.query.AfGoodsQuery">
		SELECT
      MIN(a.special_price) activityAmount,
      g.id goodsId,
      a.limit_count AS total,
      g.`name` AS goodName,
      g.goods_icon AS goodsIcon,
      g.thumbnail_icon,
      g.goods_url AS goodsUrl,
      g.price_amount,
      g.sale_amount,
      g.rebate_amount,
      g.rebate_rate,
      g.remark,
      IFNULL(COUNT(DISTINCT o.id), 0) AS volume,
      IF(s.id IS NULL ,0,1) AS subscribe,
      c.interest_free_id
    FROM
      af_goods  g
          LEFT JOIN  af_seckill_activity_goods  a ON g.`id` = a.`goods_id`  AND a.type = 2    AND a.is_delete = 0   AND a.special_price > 0
          LEFT JOIN  af_seckill_activity Y ON  y.id = a.`activity_id`  AND y.is_delete = 0  AND y.gmt_end <![CDATA[>=]]> NOW()  AND y.gmt_start <![CDATA[<=]]> NOW()
          LEFT JOIN af_goods_price b ON (a.price_id = b.id)   AND b.is_delete = 0  AND b.is_sale = 'Y'
          LEFT JOIN af_seckill_activity_order o ON g.id = o.goods_id AND o.activity_id = y.id
          LEFT JOIN af_User_Goods_Sms s ON s.goods_id = g.id

          LEFT JOIN af_scheme_goods c ON g.id = c.goods_id
          WHERE
            g.is_delete = 0
            AND g.category_id =#{categoryId}
            AND g.is_delete = 0
            AND  g.status = 'PUBLISH' AND g.source = 'SELFSUPPORT' AND g.stock_count > 0
            GROUP BY g.id
		    ORDER BY g.sale_count desc
	</select>

	<select id="getAvaliableSelfGoods" parameterType="com.ald.fanbei.api.dal.domain.query.AfGoodsDoQuery" resultType="com.ald.fanbei.api.dal.domain.AfGoodsDo">
		SELECT
			<include refid="queryFields"/>
		FROM
			af_goods
		WHERE
			is_delete = 0
		AND `status` = 'PUBLISH'
		AND source = 'SELFSUPPORT'
		<if test="keyword != null and keyword != ''">
		AND name LIKE CONCAT('%',#{keyword},'%')
		</if>
		<if test="goodsIds != null and goodsIds.size > 0">
			AND id IN
			<foreach item="item" index="index" collection="goodsIds" open="(" separator="," close=")">
				#{goodsIds[${index}],jdbcType=BIGINT}
			</foreach>
		</if>
		<if test="categoryIds != null and categoryIds.size > 0">
			AND category_id IN
			<foreach item="item" index="index" collection="categoryIds" open="(" separator="," close=")">
				#{categoryIds[${index}],jdbcType=BIGINT}
			</foreach>
		</if>
		<if test="brandIds != null and brandIds.size > 0">
			AND brand_id IN
			<foreach item="item" index="index" collection="brandIds" open="(" separator="," close=")">
				#{brandIds[${index}],jdbcType=BIGINT}
			</foreach>
		</if>
		<if test="sortword != null and sortword != ''">
		order by ${sortword}
		</if>
		<if test="sort != null and sort != ''">
		${sort}
		</if>
		
	</select>


	<select id="getHomeLeaseGoods" resultMap="leaseResultMap">
		SELECT
			a.id rid,a.goods_icon,a.name
		FROM
		af_goods_lease b LEFT JOIN af_goods a on b.goods_id = a.id
		WHERE
		a.is_delete = 0
		AND b.is_sale = 'Y'
		AND b.is_delete = 0
		ORDER BY b.sort
		LIMIT #{pageIndex},#{pageSize}
	</select>

	<select id="getLeaseGoodsByGoodsId" resultType="com.ald.fanbei.api.dal.domain.dto.LeaseGoods">
		SELECT
		<include refid="queryAllFields"/>,b.is_sale,b.buyout
		FROM
		af_goods_lease b LEFT JOIN af_goods a on b.goods_id = a.id
		WHERE
		a.is_delete = 0
		AND b.is_sale = 'Y'
		AND b.is_delete = 0
		AND b.goods_id=#{goodsId}
	</select>

	<select id="getByGoodsId" resultType="com.ald.fanbei.api.dal.domain.AfGoodsPriceDo" parameterType="java.lang.Long">
		SELECT
		lease_param,lease_amount
		from af_goods_price
		WHERE goods_id=#{rid}
	</select>

	<select id="getGoodsListByGoodsId" resultType="AfGoodsDo">
		<foreach collection="list" item="item" separator="UNION ALL" >
			SELECT
			<include refid="queryFields"/>
			FROM
			af_goods
			WHERE is_delete = 0
			AND status = 'PUBLISH'
			AND id = #{item}
		</foreach>
	</select>

	<select id="getGoodsDoByGoodsId" resultType="AfActivityGoodsDto">
		SELECT
			g.id rid,g.name,g.goods_icon,g.goods_url,g.open_id,g.num_id,g.price_amount,
			g.sale_amount,g.category_id,g.sale_count,g.gmt_start,g.gmt_end,g.status,g.source,g.rebate_amount,g.rebate_rate,g.shop_name,
			(g.sale_amount-g.rebate_amount) real_amount,g.goods_detail,sum(p.sale_count) count
		FROM
		af_goods g
		LEFT JOIN af_goods_price p ON p.is_delete = 0 AND p.is_sale = 'Y' AND p.goods_id = g.id
		where g.is_delete = 0
		AND g.status = 'PUBLISH'
		AND g.id in (#{goodsId})
	</select>


	<select id="getGoodsListByBrandId" resultType="AfGoodsDo">
		select
		<include refid="queryAllFields"></include>
		 from af_goods a where brand_id = #{brandId} and is_delete = 0 AND status = 'PUBLISH' and source = 'SELFSUPPORT' ORDER BY sale_count desc
	</select>

	<select id="getAllByBrandIdAndVolume" resultType="com.ald.fanbei.api.dal.domain.dto.HomePageSecKillGoods">
		SELECT
      MIN(a.special_price) activityAmount,
      g.id goodsId,
      a.limit_count AS total,
      g.`name` AS goodName,
      g.source,
      g.goods_icon AS goodsIcon,
      g.thumbnail_icon,
      g.goods_url AS goodsUrl,
      g.price_amount,
      g.sale_amount,
      g.rebate_amount,
      g.rebate_rate,
      g.remark,
      IFNULL(COUNT(DISTINCT o.id), 0) AS volume,
      IF(s.id IS NULL ,0,1) AS subscribe,
      c.interest_free_id
    FROM
      af_goods  g
          LEFT JOIN  af_seckill_activity_goods  a ON g.`id` = a.`goods_id`  AND a.type = 2    AND a.is_delete = 0   AND a.special_price > 0
          LEFT JOIN  af_seckill_activity Y ON  y.id = a.`activity_id`  AND y.is_delete = 0  AND y.gmt_end <![CDATA[>=]]> NOW()  AND y.gmt_start <![CDATA[<=]]> NOW()
          LEFT JOIN af_goods_price b ON (a.price_id = b.id)   AND b.is_delete = 0  AND b.is_sale = 'Y'
          LEFT JOIN af_seckill_activity_order o ON g.id = o.goods_id AND o.activity_id = y.id
          LEFT JOIN af_User_Goods_Sms s ON s.goods_id = g.id

          LEFT JOIN af_scheme_goods c ON g.id = c.goods_id
          WHERE
            g.is_delete = 0
            AND g.brand_id =#{brandId}
            AND g.is_delete = 0
            AND  g.status = 'PUBLISH' AND g.source = 'SELFSUPPORT' AND g.stock_count > 0
            GROUP BY g.id
		    ORDER BY g.sale_count desc
	</select>

	<select id="getGoodsByCategoryIdAndPrice" resultType="com.ald.fanbei.api.dal.domain.dto.HomePageSecKillGoods" parameterType="com.ald.fanbei.api.dal.domain.query.AfGoodsQuery">
		SELECT
      MIN(a.special_price) activityAmount,
      g.id goodsId,
      a.limit_count AS total,
      g.`name` AS goodName,
      g.goods_icon AS goodsIcon,
      g.thumbnail_icon,
      g.goods_url AS goodsUrl,
      g.price_amount,
      g.sale_amount,
      g.rebate_amount,
      g.rebate_rate,
      g.remark,
      IFNULL(COUNT(DISTINCT o.id), 0) AS volume,
      IF(s.id IS NULL ,0,1) AS subscribe,
      c.interest_free_id
    FROM
      af_goods  g
          LEFT JOIN  af_seckill_activity_goods  a ON g.`id` = a.`goods_id`  AND a.type = 2    AND a.is_delete = 0   AND a.special_price > 0
          LEFT JOIN  af_seckill_activity Y ON  y.id = a.`activity_id`  AND y.is_delete = 0  AND y.gmt_end <![CDATA[>=]]> NOW()  AND y.gmt_start <![CDATA[<=]]> NOW()
          LEFT JOIN af_goods_price b ON (a.price_id = b.id)   AND b.is_delete = 0  AND b.is_sale = 'Y'
          LEFT JOIN af_seckill_activity_order o ON g.id = o.goods_id AND o.activity_id = y.id
          LEFT JOIN af_User_Goods_Sms s ON s.goods_id = g.id

          LEFT JOIN af_scheme_goods c ON g.id = c.goods_id
          WHERE
            g.is_delete = 0
            AND g.category_id =#{categoryId}
            AND g.is_delete = 0
            AND  g.status = 'PUBLISH' AND g.source = 'SELFSUPPORT' AND g.stock_count > 0
            GROUP BY g.id
		    ORDER BY ifnull(MIN(a.special_price),g.sale_amount) ${sort}

	</select>

	<select id="getAvaliableSelfGoodsBySolr" parameterType="com.ald.fanbei.api.dal.domain.query.AfGoodsDoQuery" resultType="com.ald.fanbei.api.dal.domain.AfGoodsDo">
		SELECT
			<include refid="queryFields"/>
		FROM
			af_goods
		WHERE
			is_delete = 0
		AND `status` = 'PUBLISH'
		AND source = 'SELFSUPPORT'
		<if test="goodsId != null">
            AND id =#{goodsId}
  		</if>
	</select>
	<select id="getAvaliableSelfGoodsForSort" parameterType="com.ald.fanbei.api.dal.domain.query.AfGoodsDoQuery" resultType="com.ald.fanbei.api.dal.domain.AfGoodsDo">
		SELECT
			<include refid="queryFields"/>
		FROM
			af_goods
		WHERE
			is_delete = 0
		AND `status` = 'PUBLISH'
		AND source = 'SELFSUPPORT'
		<if test="goodsIds != null and goodsIds.size > 0">
			AND id IN
            <foreach item="item" index="index" collection="goodsIds" open="(" separator="," close=")">
				#{goodsIds[${index}],jdbcType=BIGINT}
			</foreach>
  		</if>
		<if test="sortword != null and sortword != ''">
		order by ${sortword}
		</if>
		<if test="sort != null and sort != ''">
		${sort}
		</if>
	</select>


	<select id="getGoodsByIds" parameterType="list" resultType="java.util.HashMap">
		SELECT
		    a.id as rid,
			a.name as goodsName,
			a.goods_icon as goodsIcon,
			a.thumbnail_icon as thumbnailIcon,
			a.goods_url as goodsUrl,
			a.open_id as openId,
			a.num_id as numId,
			a.price_amount as priceAmount,
			a.sale_amount as saleAmount,
			a.source as source,
			a.rebate_amount as rebateAmount,
			(a.sale_amount-a.rebate_amount) realAmount,
			a.stock_count as stockCount,
			b.interest_free_id as interestFreeId
		FROM
			af_goods a
		LEFT JOIN af_scheme_goods b on a.id = b.goods_id
		WHERE
			a.is_delete=0
	    AND a.id IN
		<foreach item="item" collection="list" separator="," open="("
				 close=")">
			#{item, jdbcType=BIGINT}
		</foreach>
	</select>

	<select id="getVisualGoodsByGoodsId" resultType="HashMap">
		SELECT a.name,a.rebate_amount,a.price_amount,a.sale_amount,a.goods_icon,a.id, a.rebate_rate FROM af_goods as a
		WHERE  a.is_delete = 0 AND a.status = 'PUBLISH'
		AND a.id in (
		<foreach collection="ids" item="item" index="index" separator="," >
			#{item}
		</foreach>
		) ORDER BY field(a.id,
		<foreach collection="ids" item="item" index="index" separator="," >
			#{item}
		</foreach>
		)
	</select>

	<select id="getGoodsisGlobal3" parameterType="list" resultType="java.lang.Long">
		SELECT
		a.goods_id
		FROM
		af_subject_goods a
		WHERE
		a.is_delete=0
		AND a.subject_id IN
		<foreach item="item" collection="list" index="index" separator="," open="("
				 close=")">
			#{item, jdbcType=BIGINT}
		</foreach>
	</select>

	<select id="getGoodsisGlobal1" parameterType="java.lang.Long" resultType="java.lang.Long">
		SELECT
		item_value
		FROM
		af_model_h5_item
		WHERE
		item_type = 'GOODS_ID'
		AND
		model_id=#{modelId}
		AND
		is_delete = 0
	</select>
	<select id="getAfGoodsListByBrandId" resultType="AfGoodsDo">
		select
		<include refid="queryAllFields"></include>
		from af_goods a where brand_id = #{brandId} and is_delete = 0 AND status = 'PUBLISH' and source = 'SELFSUPPORT' ORDER BY gmt_create desc
	</select>

	<select id="getTaskGoodsList" resultType="HashMap">
		select
			   g.source,
			   g.rebate_amount,
			   g.rebate_rate,
			   g.id Rid,
			   g.name,
			   g.goods_icon,
			   g.goods_url,
			   g.num_id,
			   g.price_amount,
			   g.sale_amount,
			   g.sale_count,
			   v.gmt_create,
			   g.goods_pic1,
			   c.special_price,
			   d.interest_free_id
		from af_goods_verify v,
			   af_goods g
		  LEFT JOIN
			(SELECT goods_id,special_price FROM
				af_seckill_activity_goods as a , af_seckill_activity as b
				WHERE a.id = b.id and
				a.is_delete = 0 AND b.is_delete = 0 AND b.`status` = 1 AND b.`is_disable` =0
				AND now() > b.gmt_start
				AND b.gmt_end > now()
				ORDER BY a.`special_price`) c on c.goods_id = g.`id`
		LEFT JOIN af_scheme_goods d on d.`goods_id` = g.`id` and d.is_delete =0
		where g.is_delete= 0
		   and v.is_delete= 0
		   and g.id= v.goods_id
		   and g.source= 'SELFSUPPORT'
		   and g.status= 'PUBLISH'
		<if test="categoryId != null and categoryId != ''">
			AND g.category_id = #{categoryId}
		</if>
		<if test="brandId != null and brandId != ''">
			AND g.brand_id = #{brandId}
		</if>
		 order by v.gmt_create DESC
	</select>

</mapper>

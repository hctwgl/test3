<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ald.fanbei.api.dal.dao.AfSmsRecordDao">
	<sql id="queryFields">
		id as rid,gmt_create,template_id,user_id,gmt_modified,params,type,mobile,result,is_check
	</sql>

	<insert id="addSmsRecord" parameterType="AfSmsRecordDo" useGeneratedKeys="true" keyProperty="rid">
		INSERT INTO af_sms_record(gmt_create , template_id , user_id , gmt_modified , params , type , mobile,result)
		VALUES (
		    NOW(),
		    #{templateId},
		    #{userId},
		    NOW(),
		    #{params},
		    #{type},
		    #{mobile},
		    #{result}
		)
	</insert>
	
	<select id="getLatestByUidType" resultType="AfSmsRecordDo">
		SELECT
			<include refid="queryFields" />
		FROM af_sms_record WHERE is_delete = 0 AND mobile=#{mobile} AND type=#{type} ORDER BY ID DESC LIMIT 1;
	</select>
	
	<update id="updateSmsIsCheck">
		UPDATE af_sms_record SET gmt_modified = NOW(),is_check = 1 WHERE id=#{rid}
	</update>
</mapper>
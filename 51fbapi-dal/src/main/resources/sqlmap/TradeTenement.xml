<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- af_trade_tenement_info表: 租户信息表-->
<mapper namespace="com.ald.fanbei.api.dal.dao.TradeTenementDao">


  <insert id="addTenementInfoDo" parameterType="com.ald.fanbei.api.dal.domain.AfTradeTenementInfoDo" useGeneratedKeys="true" keyProperty="id" >
  		<selectKey resultType="java.lang.Long" keyProperty="id" order="AFTER" >
	      SELECT LAST_INSERT_ID()
	    </selectKey>
		INSERT INTO af_trade_tenement_info
		<trim prefix="(" suffix=")" suffixOverrides=",">
			apply_time,
			audit_time,
			<if test="userName != null and userName != ''">
				user_name,
			</if>
			<if test="mobile != null and mobile != ''">
				mobile,
			</if>
			<if test="idNumber != null and idNumber != ''">
				id_number,
			</if>
			<if test="homeAddress != null and homeAddress != ''">
				home_address,
			</if>
			<if test="contractImageUrl != null and contractImageUrl != ''">
				contract_image_url,
			</if>
			<if test="rentType != null and rentType != ''">
				rent_type,
			</if>
			<if test="rentOnePrice != null and rentOnePrice != ''">
				rent_one_price,
			</if>
			<if test="rentSumPrice != null and rentSumPrice != ''">
				rent_sum_price,
			</if>
			<if test="beginTime != null and beginTime != ''">
				begin_time,
			</if>
			<if test="endTime != null and endTime != ''">
				end_time,
			</if>
			<if test="businessId != null and businessId != ''">
				business_id,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
				NOW(),
				NOW(),
			<if test="userName != null and userName != ''">
				#{userName,jdbcType=VARCHAR},
			</if>
			<if test="mobile != null and mobile != ''">
				#{mobile,jdbcType=VARCHAR},
			</if>
			<if test="idNumber != null and idNumber != ''">
				#{idNumber,jdbcType=VARCHAR},
			</if>
			<if test="homeAddress != null and homeAddress != ''">
				#{homeAddress},
			</if>
			 <if test="contractImageUrl != null and contractImageUrl != ''" >
		       #{contractImageUrl,jdbcType=VARCHAR},
		    </if>
		    <if test="rentType != null and rentType != ''" >
		       #{rentType,jdbcType=VARCHAR},
		    </if>
		    <if test="rentOnePrice != null and rentOnePrice != ''" >
		       #{rentOnePrice,jdbcType=DECIMAL},
		    </if>
		    <if test="rentSumPrice != null and rentSumPrice != ''" >
		       #{rentSumPrice,jdbcType=DECIMAL},
		    </if>
		    <if test="beginTime != null and beginTime != ''" >
		       #{beginTime,jdbcType=TIMESTAMP},
		    </if>
		    <if test="endTime != null and endTime != ''" >
		       #{endTime,jdbcType=TIMESTAMP},
		    </if>
		     <if test="businessId != null and businessId != ''" >
		       #{businessId},
		    </if>
		</trim>
	</insert>

	<select id="getTenementInfoDo" resultType="com.ald.fanbei.api.dal.domain.AfTradeTenementInfoDo" parameterType="java.lang.Long">
        SELECT * 
        FROM af_trade_tenement_info WHERE business_id = #{businessId}
    </select>
    
    <select id="getTenementInfoDoById" resultType="com.ald.fanbei.api.dal.domain.AfTradeTenementInfoDo" parameterType="java.lang.Long">
    	SELECT * FROM af_trade_tenement_info WHERE id=#{id}
    </select>
    
    
    
    <select id="getUserIdentityUrl" resultType="com.ald.fanbei.api.dal.domain.AfIdNumberDo" parameterType="java.lang.String">
    	SELECT * FROM af_id_number WHERE user_id=(SELECT id FROM af_user WHERE is_delete=0 and user_name=#{mobile} limit 1 )
    </select>
    
    <update id="updateTenementInfo" parameterType="com.ald.fanbei.api.dal.domain.AfTradeTenementInfoDo" >
		UPDATE af_trade_tenement_info SET apply_time = NOW(),audit_time=NOW()
			<if test="userName != null and userName != ''">
				,user_name = #{userName}
			</if>
			<if test="mobile != null and mobile != ''">
				,mobile = #{mobile}
			</if>
			<if test="idNumber != null and idNumber != ''">
				,id_number = #{idNumber}
			</if>
			<if test="homeAddress != null and homeAddress != ''">
				,home_address=#{homeAddress}
			</if>
			 <if test="contractImageUrl != null and contractImageUrl != ''" >
		       ,contract_image_url=#{contractImageUrl}
		    </if>
		    <if test="rentType != null and rentType != ''" >
		       ,rent_type=#{rentType}
		    </if>
		    <if test="rentOnePrice != null and rentOnePrice != ''" >
		       ,rent_one_price=#{rentOnePrice}
		    </if>
		    <if test="rentSumPrice != null and rentSumPrice != ''" >
		       ,rent_sum_price=#{rentSumPrice}
		    </if>
		    <if test="beginTime != null and beginTime != ''" >
		       ,begin_time=#{beginTime}
		    </if>
		    <if test="endTime != null and endTime != ''" >
		       ,end_time=#{endTime}
		    </if>
		    <if test="businessId != null and businessId != ''" >
		       ,business_id=#{businessId}
		    </if>
		    <if test="auditState != null" >
			   ,audit_state=#{auditState}
		    </if>
		WHERE id = #{id}
	</update>
	
	<select id="getUserIdBymobile" parameterType="java.lang.String" resultType="java.lang.Long">
		SELECT id FROM af_user WHERE mobile=#{mobile}
	</select>
	
	<select id="getTenementInfoDoByTime"  resultType="com.ald.fanbei.api.dal.domain.AfTradeTenementInfoDo">
		SELECT * FROM af_trade_tenement_info WHERE  business_id=#{businessId} AND apply_time LIKE CONCAT(#{applyTime},'%')
	</select>
	
	<select id="getTimeByBusinessId" parameterType="java.lang.Long" resultType="String">
		SELECT apply_time FROM `af_trade_tenement_info` WHERE business_id=#{businessId} GROUP BY SUBSTRING(apply_time,1,10) ORDER BY apply_time DESC
	</select>
</mapper>
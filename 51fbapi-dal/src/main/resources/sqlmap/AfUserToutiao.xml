<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- af_user_toutiao表:'第三方-上树请求记录模块 -->
<mapper namespace="com.ald.fanbei.api.dal.dao.AfUserToutiaoDao">
    
    <!--基本的sql查询字段 公共引用...-->
    <sql id="queryFields">
        id rid,gmt_create,gmt_modified,aid,cid,csite,ctype,mac,idfa,androidid,androidid1,imei,uuid,openudid,udid,os,ip,ts,callback_url 
    </sql>
    
    <!-- 基本的sql查询条件公共引用 -->
    <sql id="commonCondition">
    	WHERE is_delete = 0
        <if test="rid !=null">
            AND id  = #{rid,jdbcType=INTEGER}
        </if>
        <if test="gmtCreate !=null">
            AND gmt_create = #{gmtCreate,jdbcType=TIMESTAMP}
        </if>
        <if test="gmtModified !=null">
            AND gmt_modified = #{gmtModified,jdbcType=TIMESTAMP}
        </if>
        <if test="aid != null and aid != ''">
            AND aid = #{aid,jdbcType=VARCHAR}
        </if>
        <if test="cid != null and cid != ''">
            AND cid = #{cid,jdbcType=VARCHAR}
        </if>
        <if test="csite != null and csite != ''">
            AND csite = #{csite,jdbcType=VARCHAR}
        </if>
        <if test="ctype != null and ctype != ''">
            AND ctype = #{ctype,jdbcType=INTEGER}
        </if>
        <if test="mac != null and mac != ''">
            AND mac = #{mac,jdbcType=VARCHAR}
        </if>
        <if test="idfa != null and idfa != ''">
            AND idfa = #{idfa,jdbcType=VARCHAR}
        </if>
        <if test="androidid != null and androidid != ''">
            AND androidid = #{androidid,jdbcType=VARCHAR}
        </if>
        <if test="androidid1 != null and androidid1 != ''">
            AND androidid1 = #{androidid1,jdbcType=VARCHAR}
        </if>
        <if test="imei != null and imei != ''">
            AND imei = #{imei,jdbcType=VARCHAR}
        </if>
        <if test="uuid != null and uuid != ''">
            AND uuid = #{uuid,jdbcType=VARCHAR}
        </if>
        <if test="openudid != null and openudid != ''">
            AND openudid = #{openudid,jdbcType=VARCHAR}
        </if>
        <if test="udid != null and udid != ''">
            AND udid = #{udid,jdbcType=VARCHAR}
        </if>
        <if test="os != null and os != ''">
            AND os = #{os,jdbcType=INTEGER}
        </if>
        <if test="ip != null and ip != ''">
            AND ip = #{ip,jdbcType=VARCHAR}
        </if>
        <if test="ts != null and ts != ''">
            AND ts = #{ts,jdbcType=VARCHAR}
        </if>
        <if test="callbackUrl != null and callbackUrl != ''">
            AND callback_url = #{callbackUrl,jdbcType=VARCHAR}
        </if>
    </sql>

    
    <insert id="creatUser" parameterType="AfUserToutiaoDo">
        INSERT INTO af_user_toutiao
        <trim prefix="(" suffix=")" suffixOverrides="," >
	            gmt_create,
	            gmt_modified,
	        <if test="aid != null">        
	            aid,
	        </if>
	        <if test="cid != null">        
	            cid,
	        </if>
	        <if test="csite != null">        
	            csite,
	        </if>
	        <if test="ctype != null">        
	            ctype,
	        </if>
	        <if test="mac != null">        
	            mac,
	        </if>
	        <if test="idfa != null">        
	            idfa,
	        </if>
	        <if test="androidid != null">        
	            androidid,
	        </if>
	        <if test="androidid1 != null">        
	            androidid1,
	        </if>
	        <if test="imei != null">        
	            imei,
	        </if>
	        <if test="uuid != null">        
	            uuid,
	        </if>
	        <if test="openudid != null">        
	            openudid,
	        </if>
	        <if test="udid != null">        
	            udid,
	        </if>
	        <if test="os != null">        
	            os,
	        </if>
	        <if test="ip != null">        
	            ip,
	        </if>
	        <if test="ts != null">        
	            ts,
	        </if>
	        <if test="callbackUrl != null">        
	            callback_url,
	        </if>
        </trim>
        
        <trim prefix="values (" suffix=")" suffixOverrides="," >
		    now(),
            now(),
		    <if test="aid != null" >
		       #{aid},
		    </if>
		    <if test="cid != null" >
		       #{cid},
		    </if>
		    <if test="csite != null" >
		       #{csite},
		    </if>
		    <if test="ctype != null" >
		       #{ctype},
		    </if>
		    <if test="mac != null" >
		       #{mac},
		    </if>
		    <if test="idfa != null" >
		       #{idfa},
		    </if>
		    <if test="androidid != null" >
		       #{androidid},
		    </if>
		    <if test="androidid1 != null" >
		       #{androidid1},
		    </if>
		    <if test="imei != null" >
		       #{imei},
		    </if>
		    <if test="uuid != null" >
		       #{uuid},
		    </if>
		    <if test="openudid != null" >
		       #{openudid},
		    </if>
		    <if test="udid != null" >
		       #{udid},
		    </if>
		    <if test="os != null" >
		       #{os},
		    </if>
		    <if test="ip != null" >
		       #{ip},
		    </if>
		    <if test="ts != null" >
		       #{ts},
		    </if>
		    <if test="callbackUrl != null" >
		       #{callbackUrl},
		    </if>
        </trim>
    </insert>


	<select id="getUser" resultType="AfUserToutiaoDo">
        SELECT
        id rid,active,gmt_modified
        FROM af_user_toutiao
        where is_delete = 0
        <if test="imei !=null and imei!=''">
            AND imei=#{imei}
        </if>
        <if test="idfa !=null and idfa!=''">
            AND idfa=#{idfa}
        </if>
        <if test="androidid1 !=null and androidid1!=''">
            AND androidid1=#{androidid1}
        </if>
        limit 0,1
    </select>

    <select id="getUserActive" resultType="AfUserToutiaoDo">
        SELECT
        id rid,active,gmt_modified,callback_url
        FROM af_user_toutiao
        where is_delete = 0 and active='0' and <![CDATA[ DATEDIFF(NOW(),gmt_modified)<='7'  ]]>
        <if test="imei !=null and imei!=''">
            AND imei=#{imei}
        </if>
        <if test="idfa !=null and idfa!=''">
            AND idfa=#{idfa}
        </if>
        <if test="androidid1 !=null and androidid1!=''">
            AND androidid1=#{androidid1}
        </if>
        limit 0,1
    </select>

    <select id="getUserOpen" resultType="AfUserToutiaoDo">
        SELECT
        id rid,active,gmt_modified,callback_url
        FROM af_user_toutiao
        where is_delete = 0 and active='0' and isopen='0' and <![CDATA[ DATEDIFF(NOW(),gmt_modified)<='7'  ]]>
        <if test="imei !=null and imei!=''">
            AND imei=#{imei}
        </if>
        <if test="idfa !=null and idfa!=''">
            AND idfa=#{idfa}
        </if>
        <if test="androidid1 !=null and androidid1!=''">
            AND androidid1=#{androidid1}
        </if>
        limit 0,1
    </select>


    <update id="uptUser"  parameterType="AfUserToutiaoDo">
        UPDATE af_user_toutiao
        <set>
                gmt_modified = now()
        </set>
         where is_delete = 0 AND id=#{id}
    </update>

    <update id="uptUserActive"  parameterType="AfUserToutiaoDo">
        UPDATE af_user_toutiao
        <set>
            gmt_modified = now(),
            user_id = #{userIdToutiao},
            user_name = #{userNameToutiao},
            active='1'
        </set>
        where is_delete = 0 AND id=#{id}
    </update>

    <update id="uptUserOpen"  parameterType="AfUserToutiaoDo">
        UPDATE af_user_toutiao
        <set>
            gmt_modified = now(),
            user_id = #{userIdToutiao},
            user_name = #{userNameToutiao},
            isopen='1'
        </set>
        where is_delete = 0 AND id=#{id}
    </update>

</mapper>

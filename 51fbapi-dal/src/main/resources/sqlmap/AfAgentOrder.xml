<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ald.fanbei.api.dal.dao.AfAgentOrderDao">
	<sql id="queryAllFields">
		order_id,user_id,province,city,county,address,consignee,mobile,capture,remark,agent_account,agent_message,agent_id,gmt_agent_buy,gmt_closed,cancel_reason,cancel_detail,closed_reason,
		closed_detail,match_order_id,gmt_match_order,status,borrow_rate
	</sql>
	<sql id="queryFields">
		a.order_id,a.user_id,a.province,a.city,a.county,a.address,a.consignee,a.mobile,a.capture,a.remark,a.agent_id,a.status,
		o.sec_type,a.match_order_id,a.gmt_match_order,o.num_id,o.goods_name,o.goods_icon,o.price_amount,o.sale_amount,o.actual_amount,o.gmt_create
	</sql>
	<insert id="addAgentOrder" parameterType="AfAgentOrderDo" useGeneratedKeys="true" keyProperty="rid">
		INSERT INTO af_agent_order(order_id , user_id , province , city ,
		 county , address , consignee , mobile , <if test="remark !=null ">remark ,</if><if test="goodsUrl !=null ">goods_url ,</if>
		capture )
		VALUES (
    		#{orderId},
    		#{userId},
    		#{province},
    		#{city},
    		#{county},
    		#{address},
    		#{consignee},
    		#{mobile},
    		<if test="remark !=null ">#{remark},</if>
    		 <if test="goodsUrl !=null ">#{goodsUrl},</if>
    		#{capture}
		)
	</insert>
	
	
	
	<update id="updateAgentOrder" parameterType="AfAgentOrderDo" >
		UPDATE af_agent_order SET  order_id=#{orderId}
			
			<if test="userId != null">
    			,user_id=#{userId}
			</if>
			<if test="province != null">
    			,province=#{province}
			</if>
			<if test="city != null">
    			,city=#{city}
			</if>
			<if test="county != null">
    			,county=#{county}
			</if>
			<if test="address != null">
    			,address=#{address}
			</if>
			<if test="consignee != null">
    			,consignee=#{consignee}
			</if>
			<if test="mobile != null">
    			,mobile=#{mobile}
			</if>
			<if test="capture != null">
    			,capture=#{capture}
			</if>
			<if test="remark != null">
    			,remark=#{remark}
			</if>
			<if test="agentAccount != null">
    			,agent_account=#{agentAccount}
			</if>
			<if test="agentMessage != null">
    			,agent_message=#{agentMessage}
			</if>
			<if test="agentId != null">
    			,agent_id=#{agentId}
			</if>
			<if test="gmtAgentBuy != null">
    			,gmt_agent_buy=#{gmtAgentBuy}
			</if>
			<if test="gmtClosed != null">
    			,gmt_closed=#{gmtClosed}
			</if>
			<if test="cancelReason != null">
    			,cancel_reason=#{cancelReason}
			</if>
			<if test="cancelDetail != null">
    			,cancel_detail=#{cancelDetail}
			</if>
			<if test="closedReason != null">
    			,closed_reason=#{closedReason}
			</if>
			<if test="closedDetail != null">
    			,closed_detail=#{closedDetail}
			</if>
			<if test="matchOrderId != null">
    			,match_order_id=#{matchOrderId}
			</if>
			<if test="gmtMatchOrder != null">
    			,gmt_match_order=#{gmtMatchOrder}
			</if>
			<if test="borrowRate != null">
    			,borrow_rate=#{borrowRate}
			</if>
			<if test="status != null">
    			,status=#{status}
			</if>
			
			WHERE 
				order_id = #{orderId}
	</update>
	

	<select id="getAgentOrderByOrderId" resultType="AfAgentOrderDo">
	
		SELECT
			<include refid="queryAllFields"/>
		FROM
			af_agent_order
		WHERE	
			order_id = #{orderId}
		LIMIT 
			1
	 </select>
	 
	 <select id="getAgentOrderListByAgentId" resultType="AfAgentOrderDto">
	
		SELECT
			<include refid="queryFields"/>
		FROM
				af_agent_order a
			LEFT JOIN
				af_order o
			ON o.id = a.order_id
			And 
				o.is_delete = 0
		WHERE	
			a.agent_id = #{agentId}
		AND 
			a.status =#{status}
		ORDER BY
			o.gmt_create DESC
	     LIMIT 
			#{start},20
	 </select>
	 
	 <select id="getAgentOrderInfoById" resultType="AfAgentOrderDto">
	
		SELECT
			<include refid="queryFields"/>
		FROM
				af_agent_order a
			LEFT JOIN
				af_order o
			ON o.id = a.order_id
			And 
				o.is_delete = 0
		WHERE	
			a.order_id = #{orderId}

		LIMIT 
			1
	 </select>
</mapper>

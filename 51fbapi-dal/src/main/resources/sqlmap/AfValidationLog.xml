<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ald.fanbei.api.dal.dao.AfValidationLogDao">
	
	<sql id="activitySqlField">
		id,gmt_create,user_id,type,result
	</sql>

	<insert id="addValidationLog" parameterType="AfValidationLogDo" useGeneratedKeys="true" keyProperty="rid">
		INSERT INTO af_validation_log(gmt_create , user_id , type , result)
		VALUES (
    		NOW(),
    		#{userId},
    		#{type},
    		#{result}
		)
	</insert>

	<update id="updateValidationLog" parameterType="AfValidationLogDo" >
		UPDATE af_validation_log SET gmt_modified = NOW()
		<if test="userId != null">
			,user_id=#{userId}
		</if>
		<if test="type != null">
			,type=#{type}
		</if>
		<if test="result != null">
			,result=#{result}
		</if>
		WHERE id = #{rid}
	</update>

	<select id="selectByUserId" parameterType="AfValidationLogDo" resultType="com.ald.fanbei.api.dal.domain.AfValidationLogDo" >
		SELECT
		<include refid="activitySqlField" />
		from af_validation_log where gmt_create &lt; now() and gmt_create &gt; (NOW() - interval 24 hour) and user_id = #{userId} and type = #{type} ORDER by gmt_create
	</select>
	
	<select id="countFailNumWithin24H" parameterType="AfValidationLogDo" resultType="java.lang.Integer" >
		SELECT COUNT(id) FROM af_validation_log WHERE gmt_create &gt; (NOW() - interval 24 hour) and user_id = #{userId} and type = #{type} AND result = 'false'
	</select>
	
</mapper>
<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ald.fanbei.api.dal.dao.AfSignInActivityDao">

<select id = "initActivitySign" resultType = "java.util.Date">
		SELECT
			gmt_create
		FROM
			af_signin_activity
		WHERE
			user_id = #{userId}
		AND activity_id = #{activityId}
		AND DATE_FORMAT(gmt_create, '%Y-%m-%d') BETWEEN (
			SELECT
				DATE_FORMAT(value_1, '%Y-%m-%d')
			FROM
				af_resource
			WHERE
				type = 'ACTIVITY_SIGNIN'
		)
		AND (
			SELECT
				DATE_FORMAT(value_2, '%Y-%m-%d')
			FROM
				af_resource
			WHERE
				type = 'ACTIVITY_SIGNIN'
		)
</select>

<insert id = "singIn" parameterType="AfSignInActivityDo" keyProperty="rid" useGeneratedKeys="true">
	INSERT INTO af_signin_activity 
	(
		gmt_create,
		user_id,
		activity_id,
		total_count
	)
	VALUES
	(
		NOW(),
		#{userId},
		#{activityId},
		#{totalCount}
	)
</insert>

</mapper>
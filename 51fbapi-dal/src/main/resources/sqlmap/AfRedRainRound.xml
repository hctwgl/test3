<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ald.fanbei.api.dal.dao.AfRedRainRoundDao">
	<sql id="queryFields">
		id,name,status,sum,sum_grabed,gmt_start,gmt_create,gmt_modified,creator,modifier,is_delete
	</sql>
	
	<select id="fetch" resultType="AfRedRainRoundDo" parameterType="AfRedRainRoundDo" >
		SELECT 
			<include refid="queryFields"/>
		FROM af_red_rain_round WHERE is_delete = 0
		  AND status = #{status}
		  AND gmt_start &lt; #{gmtStart} LIMIT 1 FOR UPDATE
	</select>
	
	<select id="queryByGmtStartInToday" resultType="AfRedRainRoundDo" parameterType="Map" >
        SELECT 
            <include refid="queryFields"/>
        FROM af_red_rain_round WHERE is_delete = 0
          AND status != 'OVER'
          AND gmt_start BETWEEN #{gmtMin} AND #{gmtMax} ORDER BY gmt_start 
    </select>
	
	<update id="update" parameterType="AfRedRainRoundDo" >
		UPDATE af_red_rain_round 
		SET status = #{status},
		  sum = #{sum},
		  sum_grabed = #{sumGrabed}
		WHERE id = #{id}
	</update>
</mapper>
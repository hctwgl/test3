<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ald.fanbei.api.dal.dao.AfActivityDao">
	
	<sql id="activitySqlField">
		id,is_delete,gmt_create,gmt_modified,name,type,icon_url,gmt_start,gmt_end,title1,title2,title3,title4,bg_color,btn_color,link_type,link_content
	</sql>
	
	<insert id="addActivity" parameterType="AfActivityDo" keyProperty="id" useGeneratedKeys="true" >
		INSERT INTO
			af_activity
			(
				gmt_create,
				gmt_modified,
				name,
				type,
				icon_url,
				gmt_start,
				gmt_end
			)
		VALUES
		    (
				NOW(),
				NOW(),
				#{name},
				#{type},
				#{iconUrl},
				#{gmtStart},
				#{gmtEnd}
			)
	</insert>
	
	<select id="getActivityById" parameterType="java.lang.Long" resultType="AfActivityDo">
		SELECT
			<include refid="activitySqlField"/>
		FROM
			af_activity 
		WHERE
			is_delete=0
		AND
			id = #{activityId}
	</select>
	
	<select id="listAllActivity"  resultType="AfActivityDo">
		SELECT
			<include refid="activitySqlField"/>
		FROM
			af_activity 
		WHERE
			is_delete=0
	</select>
	
	<select id="listAllHomeActivity"  resultType="AfActivityDo">
		SELECT
			<include refid="activitySqlField"/>
		FROM
			af_activity 
		WHERE
			is_delete = 0
		AND
			type = 3
		AND
			tag != 'MORE'
		ORDER BY sort DESC ,gmt_create desc
	</select>
	
	<select id="getHomeMoreActivity"  resultType="AfActivityDo">
		SELECT
			<include refid="activitySqlField"/>
		FROM
			af_activity 
		WHERE
			is_delete = 0
		AND
			type = 3
		AND
			tag = 'MORE'
	</select>
	
	
	<update id="updateActivity" parameterType="AfActivityDo">
		UPDATE af_activity SET gmt_modified = NOW() 
			<if test="name != null">
			    ,name=#{name}
			</if>
			<if test="type != null">
			    ,type=#{type}
			</if>
			<if test="iconUrl != null">
			    ,icon_url=#{iconUrl}
			</if>
			<if test="gmtStart != null">
			    ,gmt_start=#{gmtStart}
			</if>
			<if test="gmtEnd != null">
			    ,gmt_end=#{gmtEnd}
			</if>
		WHERE id = #{id}
	</update>
	
	<update id="deleteActivityById" parameterType="java.lang.Long">
		UPDATE
			af_activity
		SET
			gmt_modified = NOW(),
			is_delete = 1
		WHERE
			id = #{activityId}
	</update>
	<select id="getDateListByName" parameterType="java.lang.String" resultType="java.util.Date">
		SELECT
			gmt_start
		FROM
			af_activity
		WHERE
			is_delete = 0
		AND `status` = 2
		AND `name` = #{tag};
	</select>
	
	<select id="getDateVoListByName" parameterType="java.lang.String" resultType="com.ald.fanbei.api.web.vo.SecondKillDateVo">
		SELECT
		gmt_start as start_time,
		case when (gmt_start&gt;CURRENT_TIMESTAMP()) then '0' when (gmt_end&lt;CURRENT_TIMESTAMP()) then '2' else '1' end
		as status
		FROM
		  af_activity
		WHERE
		  is_delete = 0
		AND `status` = 2
		AND `name` = #{tag}
		AND gmt_start &gt; CURDATE()
		AND gmt_start &lt; DATE_ADD(
		  CURDATE(),
		  INTERVAL 1 DAY
		) ORDER BY gmt_start LIMIT 0,5 ;
	</select>

</mapper>
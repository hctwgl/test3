<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- jsd_borrow_cashè¡¨ -->
<mapper namespace="com.ald.jsd.mgr.dal.dao.MgrBorrowCashDao">

    <select id="getApplyBorrowCashByDays" resultType="java.lang.Integer">
        SELECT
        count(distinct user_id)
        FROM
        jsd_borrow_cash  where is_delete=0 and datediff(now(),gmt_create) &lt; #{days}
    </select>

    <select id="getApplyBorrowCashBetweenStartAndEnd" resultType="java.lang.Integer">
        SELECT
        count(distinct user_id)
        FROM
        jsd_borrow_cash  where is_delete=0 and gmt_create between #{startDate} and #{endDate}
    </select>

    <select id="getBorrowCashLessThanDays" resultType="JsdBorrowCashDo">
        SELECT *
        FROM
        jsd_borrow_cash  where is_delete=0 and datediff(now(),gmt_arrival) &lt; #{days}
        and status in ('TRANSFERRED','FINISHED')
    </select>

    <select id="getBorrowCashBetweenStartAndEnd" resultType="JsdBorrowCashDo">
        SELECT *
        FROM
        jsd_borrow_cash  where is_delete=0 and gmt_arrival between #{startDate} and #{endDate}
        and status in ('TRANSFERRED','FINISHED')
    </select>

    <select id="getBorrowCashByDays" resultType="JsdBorrowCashDo">
        SELECT *
        FROM
        jsd_borrow_cash  where is_delete=0 and datediff(now(),gmt_arrival) = #{days}
        and status in ('TRANSFERRED','FINISHED')
    </select>

    <select id="getUserNumByBorrowDays" resultType="java.lang.Integer">
        SELECT
        count(distinct nbc.user_id)
        FROM
        jsd_borrow_cash bc
        left join jsd_borrow_cash nbc on bc.user_id = nbc.user_id
        where bc.is_delete=0 and datediff(now(),bc.gmt_arrival) &lt; #{days}
        and datediff(now(),nbc.gmt_arrival) &gt;= #{days}
        and bc.status in ('TRANSFERRED','FINISHED')
    </select>

    <select id="getUserNumBetweenStartAndEnd" resultType="java.lang.Integer">
        SELECT
        count(distinct nbc.user_id)
        FROM
        jsd_borrow_cash bc
        left join jsd_borrow_cash nbc on bc.user_id = nbc.user_id
        where bc.is_delete=0 and bc.gmt_arrival  between #{startDate} and #{endDate}
        and ( nbc.gmt_arrival &lt; #{startDate} or nbc.gmt_arrival &gt; #{endDate})
        and bc.status in ('TRANSFERRED','FINISHED')
    </select>

    <select id="getAmountByDays" resultType="java.math.BigDecimal">
        SELECT
        sum (amount)
        FROM
        jsd_borrow_cash  where is_delete=0 and datediff(now(),gmt_arrival) = #{days}
        and status in ('TRANSFERRED','FINISHED')
    </select>

</mapper>

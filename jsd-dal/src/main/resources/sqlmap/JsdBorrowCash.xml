<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- jsd_borrow_cash表 -->
<mapper namespace="com.ald.fanbei.api.dal.dao.JsdBorrowCashDao">
    
    <!--基本的sql查询字段 公共引用...-->
    <sql id="queryFields">
        id rid,borrow_no,trade_no_ups,trade_no_xgxy,user_id,type,amount,status,remark,card_number,card_name,overdue_status,overdue_day,arrival_amount,
        poundage,repay_principle,repay_amount,overdue_amount,overdue_rate,sum_rate,sum_overdue,sum_renewal_poundage,renewal_num,
        poundage_rate,risk_daily_rate,gmt_plan_repayment,gmt_arrival,gmt_close,gmt_create,gmt_modified,finish_date,version,
        rate_amount
    </sql>
    
    <!-- 基本的sql查询条件公共引用 -->
    <sql id="commonCondition">
    	WHERE is_delete = 0
        <if test="rid !=null">
            AND id  = #{rid,jdbcType=INTEGER}
        </if>
        <if test="borrowNo != null and borrowNo != ''">
            AND borrow_no = #{borrowNo,jdbcType=VARCHAR}
        </if>
        <if test="userId != null and userId != ''">
            AND user_id = #{userId,jdbcType=INTEGER}
        </if>
        <if test="type != null and type != ''">
            AND type = #{type,jdbcType=VARCHAR}
        </if>
        <if test="amount != null and amount != ''">
            AND amount = #{amount,jdbcType=DECIMAL}
        </if>
        <if test="status != null and status != ''">
            AND status = #{status,jdbcType=VARCHAR}
        </if>
        <if test="remark != null and remark != ''">
            AND remark = #{remark,jdbcType=VARCHAR}
        </if>
        <if test="cardNumber != null and cardNumber != ''">
            AND card_number = #{cardNumber,jdbcType=VARCHAR}
        </if>
        <if test="cardName != null and cardName != ''">
            AND card_name = #{cardName,jdbcType=VARCHAR}
        </if>
        <if test="overdueStatus != null and overdueStatus != ''">
            AND overdue_status = #{overdueStatus,jdbcType=VARCHAR}
        </if>
        <if test="overdueDay != null and overdueDay != ''">
            AND overdue_day = #{overdueDay,jdbcType=INTEGER}
        </if>
        <if test="arrivalAmount != null and arrivalAmount != ''">
            AND arrival_amount = #{arrivalAmount,jdbcType=DECIMAL}
        </if>
        <if test="poundage != null and poundage != ''">
            AND poundage = #{poundage,jdbcType=DECIMAL}
        </if>
        <if test="repayPrinciple != null and repayPrinciple != ''">
            AND repay_principle = #{repayPrinciple,jdbcType=DECIMAL}
        </if>
        <if test="repayAmount != null and repayAmount != ''">
            AND repay_amount = #{repayAmount,jdbcType=DECIMAL}
        </if>
        <if test="overdueAmount != null and overdueAmount != ''">
            AND overdue_amount = #{overdueAmount,jdbcType=DECIMAL}
        </if>
        <if test="sumRate != null and sumRate != ''">
            AND sum_rate = #{sumRate,jdbcType=DECIMAL}
        </if>
        <if test="sumOverdue != null and sumOverdue != ''">
            AND sum_overdue = #{sumOverdue,jdbcType=DECIMAL}
        </if>
        <if test="sumRenewalPoundage != null and sumRenewalPoundage != ''">
            AND sum_renewal_poundage = #{sumRenewalPoundage,jdbcType=DECIMAL}
        </if>
        <if test="renewalNum != null and renewalNum != ''">
            AND renewal_num = #{renewalNum,jdbcType=INTEGER}
        </if>
        <if test="poundageRate != null and poundageRate != ''">
            AND poundage_rate = #{poundageRate,jdbcType=DECIMAL}
        </if>
        <if test="riskDailyRate != null and riskDailyRate != ''">
            AND risk_daily_rate = #{riskDailyRate,jdbcType=DECIMAL}
        </if>
        <if test="gmtPlanRepayment !=null">
            AND gmt_plan_repayment = #{gmtPlanRepayment,jdbcType=TIMESTAMP}
        </if>
        <if test="gmtArrival !=null">
            AND gmt_arrival = #{gmtArrival,jdbcType=TIMESTAMP}
        </if>
        <if test="gmtClose !=null">
            AND gmt_close = #{gmtClose,jdbcType=TIMESTAMP}
        </if>
        <if test="gmtCreate !=null">
            AND gmt_create = #{gmtCreate,jdbcType=TIMESTAMP}
        </if>
        <if test="gmtModified !=null">
            AND gmt_modified = #{gmtModified,jdbcType=TIMESTAMP}
        </if>
        <if test="finishDate != null and finishDate != ''">
            AND finish_date = #{finishDate,jdbcType=VARCHAR}
        </if>
        <if test="version != null and version != ''">
            AND version = #{version,jdbcType=VARCHAR}
        </if>
        <if test="rateAmount != null and rateAmount != ''">
            AND rate_amount = #{rateAmount,jdbcType=VARCHAR}
        </if>
    </sql>
    <select id ="getBorrowCashByStatusNotInFinshAndClosed" resultType="JsdBorrowCashDo">
        SELECT
        <include refid="queryFields" />
        FROM
        jsd_borrow_cash
        WHERE
        is_delete = 0
        AND
        user_id = #{userId}
        and status not in ('CLOSED','FINISHED','TRANSEDFAIL');
    </select>
    
    <insert id="saveRecord" parameterType="com.ald.fanbei.api.dal.domain.JsdBorrowCashDo" keyProperty="rid" useGeneratedKeys="true">
        INSERT INTO jsd_borrow_cash
        <trim prefix="(" suffix=")" suffixOverrides="," >
	        <if test="borrowNo != null">        
	            borrow_no,
	        </if>
	        <if test="tradeNoUps != null">        
                trade_no_ups,
            </if>
            <if test="tradeNoXgxy != null">        
                trade_no_xgxy,
            </if>
	        <if test="userId != null">        
	            user_id,
	        </if>
	        <if test="type != null">        
	            type,
	        </if>
	        <if test="amount != null">        
	            amount,
	        </if>
	        <if test="status != null">        
	            status,
	        </if>
	        <if test="remark != null">        
	            remark,
	        </if>
	        <if test="cardNumber != null">        
	            card_number,
	        </if>
	        <if test="cardName != null">        
	            card_name,
	        </if>
	        <if test="overdueStatus != null">        
	            overdue_status,
	        </if>
	        <if test="overdueDay != null">        
	            overdue_day,
	        </if>
	        <if test="arrivalAmount != null">        
	            arrival_amount,
	        </if>
	        <if test="poundage != null">        
	            poundage,
	        </if>
	        <if test="repayPrinciple != null">        
	            repay_principle,
	        </if>
	        <if test="repayAmount != null">        
	            repay_amount,
	        </if>
	        <if test="overdueAmount != null">        
	            overdue_amount,
	        </if>
	        <if test="sumRate != null">        
	            sum_rate,
	        </if>
	        <if test="sumOverdue != null">        
	            sum_overdue,
	        </if>
	        <if test="sumRenewalPoundage != null">        
	            sum_renewal_poundage,
	        </if>
	        <if test="renewalNum != null">        
	            renewal_num,
	        </if>
	        <if test="poundageRate != null">        
	            poundage_rate,
	        </if>
	        <if test="riskDailyRate != null">        
	            risk_daily_rate,
	        </if>
	        <if test="gmtPlanRepayment != null">        
	            gmt_plan_repayment,
	        </if>
	        <if test="gmtArrival != null">        
	            gmt_arrival,
	        </if>
	        <if test="gmtClose != null">        
	            gmt_close,
	        </if>
	        <if test="gmtCreate != null">        
	            gmt_create,
	        </if>
	        <if test="gmtModified != null">        
	            gmt_modified,
	        </if>
	        <if test="finishDate != null">        
	            finish_date,
	        </if>
	        <if test="version != null">        
	            version,
	        </if>
	        <if test="rateAmount != null">
	            rate_amount,
	        </if>
        </trim>
        
        <trim prefix="values (" suffix=")" suffixOverrides="," >
		    <if test="borrowNo != null" >
		       #{borrowNo,jdbcType=VARCHAR},
		    </if>
		    <if test="tradeNoUps != null">        
                #{tradeNoUps,jdbcType=VARCHAR},
            </if>
            <if test="tradeNoXgxy != null">        
                #{tradeNoXgxy,jdbcType=VARCHAR},
            </if>
		    <if test="userId != null" >
		       #{userId,jdbcType=INTEGER},
		    </if>
		    <if test="type != null" >
		       #{type,jdbcType=VARCHAR},
		    </if>
		    <if test="amount != null" >
		       #{amount,jdbcType=DECIMAL},
		    </if>
		    <if test="status != null" >
		       #{status,jdbcType=VARCHAR},
		    </if>
		    <if test="remark != null" >
		       #{remark,jdbcType=VARCHAR},
		    </if>
		    <if test="cardNumber != null" >
		       #{cardNumber,jdbcType=VARCHAR},
		    </if>
		    <if test="cardName != null" >
		       #{cardName,jdbcType=VARCHAR},
		    </if>
		    <if test="overdueStatus != null" >
		       #{overdueStatus,jdbcType=VARCHAR},
		    </if>
		    <if test="overdueDay != null" >
		       #{overdueDay,jdbcType=INTEGER},
		    </if>
		    <if test="arrivalAmount != null" >
		       #{arrivalAmount,jdbcType=DECIMAL},
		    </if>
		    <if test="poundage != null" >
		       #{poundage,jdbcType=DECIMAL},
		    </if>
		    <if test="repayPrinciple != null" >
		       #{repayPrinciple,jdbcType=DECIMAL},
		    </if>
		    <if test="repayAmount != null" >
		       #{repayAmount,jdbcType=DECIMAL},
		    </if>
		    <if test="overdueAmount != null" >
		       #{overdueAmount,jdbcType=DECIMAL},
		    </if>
		    <if test="sumRate != null" >
		       #{sumRate,jdbcType=DECIMAL},
		    </if>
		    <if test="sumOverdue != null" >
		       #{sumOverdue,jdbcType=DECIMAL},
		    </if>
		    <if test="sumRenewalPoundage != null" >
		       #{sumRenewalPoundage,jdbcType=DECIMAL},
		    </if>
		    <if test="renewalNum != null" >
		       #{renewalNum,jdbcType=INTEGER},
		    </if>
		    <if test="poundageRate != null" >
		       #{poundageRate,jdbcType=DECIMAL},
		    </if>
		    <if test="riskDailyRate != null" >
		       #{riskDailyRate,jdbcType=DECIMAL},
		    </if>
		    <if test="gmtPlanRepayment != null" >
		       #{gmtPlanRepayment,jdbcType=TIMESTAMP},
		    </if>
		    <if test="gmtArrival != null" >
		       #{gmtArrival,jdbcType=TIMESTAMP},
		    </if>
		    <if test="gmtClose != null" >
		       #{gmtClose,jdbcType=TIMESTAMP},
		    </if>
		    <if test="gmtCreate != null" >
		       #{gmtCreate,jdbcType=TIMESTAMP},
		    </if>
		    <if test="gmtModified != null" >
		       #{gmtModified,jdbcType=TIMESTAMP},
		    </if>
		    <if test="finishDate != null" >
		       #{finishDate,jdbcType=VARCHAR},
		    </if>
		    <if test="rdBeforeOverdueStatus != null" >
		       #{rdBeforeOverdueStatus,jdbcType=VARCHAR},
		    </if>
		    <if test="version != null" >
		       #{version,jdbcType=VARCHAR},
		    </if>
		    <if test="rateAmount != null" >
		       #{rateAmount,jdbcType=VARCHAR},
		    </if>
        </trim>
    </insert>
    
    <update id="updateById"  parameterType="com.ald.fanbei.api.dal.domain.JsdBorrowCashDo">
        UPDATE jsd_borrow_cash
          <set>
            <if test="borrowNo != null and borrowNo != '' ">        
                borrow_no = #{borrowNo,jdbcType=VARCHAR},                
            </if>
            <if test="tradeNoUps != null and tradeNoUps != '' ">        
                trade_no_ups = #{tradeNoUps,jdbcType=VARCHAR},
            </if>
            <if test="tradeNoXgxy != null and tradeNoXgxy != '' ">        
                trade_no_xgxy = #{tradeNoXgxy,jdbcType=VARCHAR},
            </if>
            <if test="userId != null and userId != '' ">        
                user_id = #{userId,jdbcType=INTEGER},                
            </if>
            <if test="type != null and type != '' ">        
                type = #{type,jdbcType=VARCHAR},                
            </if>
            <if test="amount != null and amount != '' ">        
                amount = #{amount,jdbcType=DECIMAL},                
            </if>
            <if test="status != null and status != '' ">        
                status = #{status,jdbcType=VARCHAR},                
            </if>
            <if test="remark != null and remark != '' ">        
                remark = #{remark,jdbcType=VARCHAR},                
            </if>
            <if test="cardNumber != null and cardNumber != '' ">        
                card_number = #{cardNumber,jdbcType=VARCHAR},                
            </if>
            <if test="cardName != null and cardName != '' ">        
                card_name = #{cardName,jdbcType=VARCHAR},                
            </if>
            <if test="overdueStatus != null and overdueStatus != '' ">        
                overdue_status = #{overdueStatus,jdbcType=VARCHAR},                
            </if>
            <if test="overdueDay != null and overdueDay != '' ">        
                overdue_day = #{overdueDay,jdbcType=INTEGER},                
            </if>
            <if test="arrivalAmount != null and arrivalAmount != '' ">        
                arrival_amount = #{arrivalAmount,jdbcType=DECIMAL},                
            </if>
            <if test="poundage != null and poundage != '' ">        
                poundage = #{poundage,jdbcType=DECIMAL},                
            </if>
            <if test="repayPrinciple != null and repayPrinciple != '' ">        
                repay_principle = #{repayPrinciple,jdbcType=DECIMAL},                
            </if>
            <if test="repayAmount != null and repayAmount != '' ">        
                repay_amount = #{repayAmount,jdbcType=DECIMAL},                
            </if>
            <if test="overdueAmount != null and overdueAmount != '' ">        
                overdue_amount = #{overdueAmount,jdbcType=DECIMAL},                
            </if>
            <if test="sumRate != null and sumRate != '' ">        
                sum_rate = #{sumRate,jdbcType=DECIMAL},                
            </if>
            <if test="sumOverdue != null and sumOverdue != '' ">        
                sum_overdue = #{sumOverdue,jdbcType=DECIMAL},                
            </if>
            <if test="sumRenewalPoundage != null and sumRenewalPoundage != '' ">        
                sum_renewal_poundage = #{sumRenewalPoundage,jdbcType=DECIMAL},                
            </if>
            <if test="renewalNum != null and renewalNum != '' ">        
                renewal_num = #{renewalNum,jdbcType=INTEGER},                
            </if>
            <if test="poundageRate != null and poundageRate != '' ">        
                poundage_rate = #{poundageRate,jdbcType=DECIMAL},                
            </if>
            <if test="riskDailyRate != null and riskDailyRate != '' ">        
                risk_daily_rate = #{riskDailyRate,jdbcType=DECIMAL},                
            </if>
            <if test="gmtPlanRepayment != null and gmtPlanRepayment != '' ">        
                gmt_plan_repayment = #{gmtPlanRepayment,jdbcType=TIMESTAMP},                
            </if>
            <if test="gmtArrival != null and gmtArrival != '' ">        
                gmt_arrival = #{gmtArrival,jdbcType=TIMESTAMP},                
            </if>
            <if test="gmtClose != null and gmtClose != '' ">        
                gmt_close = #{gmtClose,jdbcType=TIMESTAMP},                
            </if>
            <if test="finishDate != null and finishDate != '' ">        
                finish_date = #{finishDate,jdbcType=VARCHAR},                
            </if>
            <if test="version != null and version != '' ">        
                version = #{version,jdbcType=VARCHAR},          
            </if>
            gmt_modified = NOW()
        </set>    
        WHERE is_delete = 0 AND id = #{rid ,jdbcType=BIGINT}
    </update>

	<select id="getById" resultType="com.ald.fanbei.api.dal.domain.JsdBorrowCashDo">
        SELECT
        <include refid="queryFields" />
        FROM jsd_borrow_cash
        WHERE is_delete = 0 AND id=#{rid ,jdbcType=BIGINT}
        LIMIT 0,1
    </select>

	<select id="getByCommonCondition" resultType="com.ald.fanbei.api.dal.domain.JsdBorrowCashDo" parameterType="com.ald.fanbei.api.dal.domain.JsdBorrowCashDo">
        SELECT
        <include refid="queryFields" />
        FROM jsd_borrow_cash
        <include refid="commonCondition"/> 
        limit 0,1
    </select>
               
    <select id="getListByCommonCondition" resultType="com.ald.fanbei.api.dal.domain.JsdBorrowCashDo" parameterType="com.ald.fanbei.api.dal.domain.JsdBorrowCashDo">
        SELECT
        <include refid="queryFields" />
        FROM jsd_borrow_cash
        <include refid="commonCondition"/>
    </select>

    <select id="getByBorrowNo" resultType="JsdBorrowCashDo">
        SELECT
        <include refid="queryFields" />
        FROM jsd_borrow_cash
        WHERE is_delete = 0 AND borrow_no=#{borrowNo}
        LIMIT 1
    </select>
    
    <select id="getByTradeNoXgxy" resultType="JsdBorrowCashDo">
        SELECT
        <include refid="queryFields" />
        FROM jsd_borrow_cash
        WHERE is_delete = 0 AND trade_no_xgxy=#{tradeNoXgxy}
        LIMIT 1
    </select>
    
    <select id="getCurrentLastBorrowNo" resultType="java.lang.String">
		select borrow_no from jsd_borrow_cash WHERE borrow_no LIKE CONCAT(#{orderNoPre},"%") ORDER BY id DESC LIMIT 1;
	</select>

    <select id="getBorrowCashOverdueCount" resultType="java.lang.Integer">
		SELECT
			count(*)
		FROM
			jsd_borrow_cash b where b.is_delete=0 and b.gmt_plan_repayment <![CDATA[   <  ]]> #{nowTime}  and status ='TRANSED'
	</select>

    <select id="getBorrowCashOverduePaging" resultType="JsdBorrowCashDo">
        SELECT
        <include refid="queryFields"/>
        FROM
        jsd_borrow_cash b where b.is_delete=0 and b.gmt_plan_repayment <![CDATA[   <  ]]> #{nowTime}
        and status='TRANSED' limit #{beginIndex}, #{pageSize}
    </select>


    <select id="getBorrowCashNoFinshListCountByTypePre" resultType="int">
		SELECT
			count(*)
		FROM
			af_borrow_cash b where b.is_delete=0
			and  status ='TRANSED' and b.gmt_plan_repayment <![CDATA[   <  ]]> #{nowTime} and user_id in (${userIds})
	</select>

</mapper>

<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ald.fanbei.api.dal.dao.AfUserAppealLogDao">

	<sql id="allFields">
		id rid,user_id,old_mobile,new_mobile,real_name,citizen_id,msg,status,gmt_create,gmt_modified,is_delete
	</sql>
	
	<select id="getLatestByUserId" parameterType="java.lang.Long" resultType="AfUserAppealLogDo">
		SELECT
			<include refid="allFields" />
		FROM af_user_appeal_log
		WHERE user_id = #{userId}
		  AND is_delete = 0
		ORDER BY gmt_create DESC
		LIMIT 1
	</select>
	
	<insert id="insert" parameterType="AfUserAppealLogDo" useGeneratedKeys="true" keyProperty="rid">
		INSERT INTO af_user_appeal_log (
		  user_id,
		  old_mobile,
		  new_mobile,
          status,
		  gmt_create,
		  is_delete
		  ) 
		VALUES (
		  #{userId},
		  #{oldMobile},
		  #{newMobile},
		  #{status},
		  NOW(),
		  0
		)
	</insert>
	<update id="update" parameterType="AfUserAppealLogDo">
		UPDATE af_user_appeal_log
		SET gmt_modified = NOW()
			<if test="realName != null">
				,real_name = #{realName}
			</if>
			<if test="citizenId != null" >
				,citizen_id = #{citizenId}
			</if>
			<if test="msg != null" >
				,msg = #{msg}
			</if>
			<if test="status != null" >
                ,status = #{status}
            </if>
		WHERE id = #{rid}
	</update>
	
</mapper>
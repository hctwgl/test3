<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- af_view_asset_borrow_cash表:资产可用债权信息模块 -->
<mapper namespace="com.ald.fanbei.api.dal.dao.AfViewAssetBorrowCashDao">
    
    <!--基本的sql查询字段 公共引用...-->
    <sql id="queryFields">
        borrow_cash_id,user_id,real_name,borrow_no,amount,arrival_amount,poundage_rate,base_bank_rate,type,gmt_create,gmt_arrival,id_number,user_name,mobile,address,province,city,county,card_name,card_number,contactor_type,contactor_name,id_front_url,id_behind_url,contract_pdf_url,borrow_remark,refund_remark 
    </sql>
    
    <!-- 基本的sql查询条件公共引用 -->
    <sql id="commonCondition">
    	WHERE is_delete = 0
        <if test="borrowCashId != null and borrowCashId != ''">
            AND borrow_cash_id = #{borrowCashId,jdbcType=INTEGER}
        </if>
        <if test="userId != null and userId != ''">
            AND user_id = #{userId,jdbcType=INTEGER}
        </if>
        <if test="realName != null and realName != ''">
            AND real_name = #{realName,jdbcType=VARCHAR}
        </if>
        <if test="borrowNo != null and borrowNo != ''">
            AND borrow_no = #{borrowNo,jdbcType=VARCHAR}
        </if>
        <if test="amount != null and amount != ''">
            AND amount = #{amount,jdbcType=DECIMAL}
        </if>
        <if test="arrivalAmount != null and arrivalAmount != ''">
            AND arrival_amount = #{arrivalAmount,jdbcType=DECIMAL}
        </if>
        <if test="poundageRate != null and poundageRate != ''">
            AND poundage_rate = #{poundageRate,jdbcType=DECIMAL}
        </if>
        <if test="baseBankRate != null and baseBankRate != ''">
            AND base_bank_rate = #{baseBankRate,jdbcType=DECIMAL}
        </if>
        <if test="type != null and type != ''">
            AND type = #{type,jdbcType=VARCHAR}
        </if>
        <if test="gmtCreate !=null">
            AND gmt_create = #{gmtCreate,jdbcType=TIMESTAMP}
        </if>
        <if test="gmtArrival !=null">
            AND gmt_arrival = #{gmtArrival,jdbcType=TIMESTAMP}
        </if>
        <if test="idNumber != null and idNumber != ''">
            AND id_number = #{idNumber,jdbcType=VARCHAR}
        </if>
        <if test="userName != null and userName != ''">
            AND user_name = #{userName,jdbcType=VARCHAR}
        </if>
        <if test="mobile != null and mobile != ''">
            AND mobile = #{mobile,jdbcType=VARCHAR}
        </if>
        <if test="address != null and address != ''">
            AND address = #{address,jdbcType=VARCHAR}
        </if>
        <if test="province != null and province != ''">
            AND province = #{province,jdbcType=VARCHAR}
        </if>
        <if test="city != null and city != ''">
            AND city = #{city,jdbcType=VARCHAR}
        </if>
        <if test="county != null and county != ''">
            AND county = #{county,jdbcType=VARCHAR}
        </if>
        <if test="cardName != null and cardName != ''">
            AND card_name = #{cardName,jdbcType=VARCHAR}
        </if>
        <if test="cardNumber != null and cardNumber != ''">
            AND card_number = #{cardNumber,jdbcType=VARCHAR}
        </if>
        <if test="contactorType != null and contactorType != ''">
            AND contactor_type = #{contactorType,jdbcType=VARCHAR}
        </if>
        <if test="contactorName != null and contactorName != ''">
            AND contactor_name = #{contactorName,jdbcType=VARCHAR}
        </if>
        <if test="idFrontUrl != null and idFrontUrl != ''">
            AND id_front_url = #{idFrontUrl,jdbcType=VARCHAR}
        </if>
        <if test="idBehindUrl != null and idBehindUrl != ''">
            AND id_behind_url = #{idBehindUrl,jdbcType=VARCHAR}
        </if>
        <if test="contractPdfUrl != null and contractPdfUrl != ''">
            AND contract_pdf_url = #{contractPdfUrl,jdbcType=VARCHAR}
        </if>
    </sql>

	<select id="getByBorrowCashId" resultType="com.ald.fanbei.api.dal.domain.AfViewAssetBorrowCashDo">
        SELECT
        <include refid="queryFields" />
        FROM af_view_asset_borrow_cash
        WHERE is_delete = 0 AND id=#{rid ,jdbcType=BIGINT}
        LIMIT 0,1
    </select>

	<select id="getByCommonCondition" resultType="com.ald.fanbei.api.dal.domain.AfViewAssetBorrowCashDo" parameterType="com.ald.fanbei.api.dal.domain.AfViewAssetBorrowCashDo">
        SELECT
        <include refid="queryFields" />
        FROM af_view_asset_borrow_cash
        WHERE  borrow_cash_id=#{borrowCashId ,jdbcType=BIGINT}
        limit 0,1
    </select>
               
    <select id="getListByQueryCondition" resultType="com.ald.fanbei.api.dal.domain.AfViewAssetBorrowCashDo" parameterType="com.ald.fanbei.api.dal.domain.query.AfViewAssetBorrowCashQuery">
        SELECT
        <include refid="queryFields" />
        FROM af_view_asset_borrow_cash
        WHERE 1=1
        <if test="type != null and type != ''">
            AND type = #{type,jdbcType=VARCHAR}
        </if>
        <if test="gmtCreateStart !=null and gmtCreateStart != ''">
            AND gmt_create <![CDATA[ >= ]]> #{gmtCreateStart,jdbcType=TIMESTAMP}
        </if>
        <if test="gmtCreateEnd !=null and gmtCreateEnd != ''">
            AND gmt_create <![CDATA[ <= ]]> #{gmtCreateEnd,jdbcType=TIMESTAMP}
        </if>
        <if test="minBorrowCashId !=null and minBorrowCashId != ''">
            AND borrow_cash_id <![CDATA[ > ]]> #{minBorrowCashId}
        </if>
         <if test="userIds !=null and userIds != ''">
        	AND user_id not in 
            <foreach collection="userIds" open="(" close=")" separator="," index="index">
                #{userIds[${index}]}
            </foreach>
        </if>
            order by borrow_cash_id asc
       <if test="limitNums !=null and limitNums != ''">
           limit #{limitNums}
        </if>
    </select>
    
    <select id="getSumAmount" resultType="java.math.BigDecimal">
    	SELECT
			IFNULL(SUM(amount),0)
		FROM
			af_view_asset_borrow_cash
		WHERE
			gmt_create BETWEEN #{gmtCreateStart} AND #{gmtCreateEnd}
    </select>
    
    <select id="getSumMinAmount" resultType="java.math.BigDecimal">
    	SELECT
			IFNULL(SUM(amount),0)
		FROM
			af_view_asset_borrow_cash
		WHERE
			gmt_create BETWEEN #{gmtCreateStart} AND #{gmtCreateEnd}
		AND
			type= #{minBorrowTime}
    </select>
    
    <select id="getSumMaxAmount" resultType="java.math.BigDecimal">
    	SELECT
			IFNULL(SUM(amount),0)
		FROM
			af_view_asset_borrow_cash
		WHERE
			gmt_create BETWEEN #{gmtCreateStart} AND #{gmtCreateEnd}
		AND
			type= #{maxBorrowTime}
    </select>
    
    <select id="getByQueryCondition" resultType="com.ald.fanbei.api.dal.domain.AfViewAssetBorrowCashDo" parameterType="com.ald.fanbei.api.dal.domain.query.AfViewAssetBorrowCashQuery">
        SELECT
        <include refid="queryFields" />
        FROM af_view_asset_borrow_cash
        WHERE 1=1
        <if test="type != null and type != ''">
            AND type = #{type,jdbcType=VARCHAR}
        </if>
        <if test="gmtCreateStart !=null and gmtCreateStart != ''">
            AND gmt_create <![CDATA[ >= ]]> #{gmtCreateStart,jdbcType=TIMESTAMP}
        </if>
        <if test="gmtCreateEnd !=null and gmtCreateEnd != ''">
            AND gmt_create <![CDATA[ <= ]]> #{gmtCreateEnd,jdbcType=TIMESTAMP}
        </if>
        <if test="minBorrowCashId !=null and minBorrowCashId != ''">
            AND borrow_cash_id <![CDATA[ > ]]> #{minBorrowCashId}
        </if>
         <if test="userIds !=null and userIds != ''">
        	AND user_id not in 
            <foreach collection="userIds" open="(" close=")" separator="," index="index">
                #{userIds[${index}]}
            </foreach>
        </if>
            order by borrow_cash_id asc
       <if test="limitNums !=null and limitNums != ''">
           limit 1
        </if>
    </select>
    
    <select id="checkAmount" resultType="java.math.BigDecimal" parameterType="com.ald.fanbei.api.dal.domain.query.AfViewAssetBorrowCashQuery">
        SELECT
        	IFNULL(SUM(amount),0)
        FROM 
       		af_view_asset_borrow_cash
        WHERE 
        	1=1
        <if test="type != null and type != ''">
            AND type = #{type,jdbcType=VARCHAR}
        </if>
        <if test="gmtCreateStart !=null and gmtCreateStart != ''">
            AND gmt_create <![CDATA[ >= ]]> #{gmtCreateStart,jdbcType=TIMESTAMP}
        </if>
        <if test="gmtCreateEnd !=null and gmtCreateEnd != ''">
            AND gmt_create <![CDATA[ <= ]]> #{gmtCreateEnd,jdbcType=TIMESTAMP}
        </if>
        <if test="minBorrowCashId !=null and minBorrowCashId != ''">
            AND borrow_cash_id <![CDATA[ <= ]]> #{minBorrowCashId}
        </if>
         <if test="userIds !=null and userIds != ''">
        	AND user_id not in 
            <foreach collection="userIds" open="(" close=")" separator="," index="index">
                #{userIds[${index}]}
            </foreach>
        </if>
    </select>
    
</mapper>

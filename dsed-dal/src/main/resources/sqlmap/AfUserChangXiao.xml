<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ald.fanbei.api.dal.dao.AfUserChangXiaoDao">

	<insert id="insertChangXiaoUser" parameterType="AfUserChangXiaoDo" keyProperty="id" useGeneratedKeys="true" >
		INSERT INTO
			af_user_changxiao
			(
				os,
				os_version,
				ip,
				mac,
				imei,
				ua,
				callback_url,
				idfa
			)
		VALUES
		    (
				#{os},
				#{osVersion},
				#{ip},
				#{mac},
				#{imei},
				#{ua},
				#{callbackUrl},
				#{idfa}
			)
	</insert>

	<select id="getUser" resultType="AfUserChangXiaoDo">
		SELECT
		id,gmt_modified,callback_url,os,os_version as osVersion,imei,idfa
		FROM af_user_changxiao
		where is_delete = 0
		<if test="imei !=null and imei!=''">
			AND imei=#{imei}
		</if>
		<if test="idfa !=null and idfa!=''">
			AND idfa=#{idfa}
		</if>
		limit 0,1
	</select>

	<!-- 查看用户是否已经启动过app-->
	<select id="getUserOpen" resultType="AfUserChangXiaoDo">
		SELECT
		id,gmt_modified,callback_url,os,os_version as osVersion,imei,idfa
		FROM af_user_changxiao
		where is_delete = 0 and open = 0
		<if test="imei !=null and imei!=''">
			AND imei=#{imei}
		</if>
		<if test="idfa !=null and idfa!=''">
			AND idfa=#{idfa}
		</if>
		limit 0,1
	</select>

	<!-- 更新app已经启动-->
	<update id="updateUserOpen"  parameterType="AfUserChangXiaoDo">
		UPDATE af_user_changxiao
		<set>
			gmt_modified = now(),
			open = 1
		</set>
		where is_delete = 0 AND id=#{id}
	</update>

	<!-- 更新用户信息-->
	<update id="updateUser"  parameterType="AfUserChangXiaoDo">
		UPDATE af_user_changxiao
		<set>
			gmt_modified = now(),
			imei = #{imei},
			idfa = #{idfa},
			callback_url = #{callbackUrl}
		</set>
		where is_delete = 0 AND id=#{id}
	</update>

</mapper>
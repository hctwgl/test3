<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- af_user_withhold表:用户代扣信息模块 -->
<mapper namespace="com.ald.fanbei.api.dal.dao.AfUserWithholdDao">
    
    <!--基本的sql查询字段 公共引用...-->
    <sql id="queryFields">
        id rid,gmt_create,gmt_modified,user_name,user_id,card_number1,card_number2,card_number3,card_number4,card_number5,is_withhold,usebalance,lastopen_time 
    </sql>
    
    <!-- 基本的sql查询条件公共引用 -->
  
      <select id="getAfUserWithholdDtoByUserId" parameterType="java.lang.Long" resultType="AfUserWithholdDo">
    	SELECT
        	<include refid="queryFields" />
        FROM af_user_withhold
        WHERE is_delete = 0
        AND user_id=#{userId}
    </select>

	<select id="getByUserId" resultType="com.ald.fanbei.api.dal.domain.AfUserWithholdDo" parameterType="com.ald.fanbei.api.dal.domain.AfUserWithholdDo">
	        SELECT
	        id,user_id,card_id1,card_id2,card_id3,card_id4,card_id5,usebalance
	        FROM af_user_withhold
	        WHERE user_id = #{userId} and is_delete=0 and is_withhold='1'
	        limit 0,1
	    </select>

    <insert id="insertAfUserWithholdDto" keyProperty="id" useGeneratedKeys="true" parameterType="AfUserWithholdDo">
    	INSERT INTO 
    	`af_user_withhold` 
    	(user_name,user_id,is_withhold,usebalance
    	<if test="cardNumber1 != null">
			,card_number1
		</if>
		<if test="cardNumber2 != null">
			,card_number2
		</if>
		<if test="cardNumber3 != null">
			,card_number3
		</if>
		<if test="cardNumber4 != null">
			,card_number4
		</if>
		<if test="cardNumber5 != null">
			,card_number5
		</if>
		<if test="cardId1 != null">
			,card_id1
		</if>
		<if test="cardId2 != null">
			,card_id2
		</if>
		<if test="cardId3 != null">
			,card_id3
		</if>
		<if test="cardId4 != null">
			,card_id4
		</if>
		<if test="cardId5 != null">
			,card_id5
		</if>
	)
		VALUES(#{userName},#{userId},#{isWithhold},#{usebalance}
		<if test="cardNumber1 != null">
			,#{cardNumber1}
		</if>
		<if test="cardNumber2 != null">
			,#{cardNumber2}
		</if>
		<if test="cardNumber3 != null">
			,#{cardNumber3}
		</if>
		<if test="cardNumber4 != null">
			,#{cardNumber4}
		</if>
		<if test="cardNumber5 != null">
			,#{cardNumber5}
		</if>
		<if test="cardId1 != null">
			,#{cardId1}
		</if>
		<if test="cardId2 != null">
			,#{cardId2}
		</if>
		<if test="cardId3 != null">
			,#{cardId3}
		</if>
		<if test="cardId4 != null">
			,#{cardId4}
		</if>
		<if test="cardId5 != null">
			,#{cardId5}
		</if>
		)
    </insert>

    <update id="updateAfUserWithholdDtoByUserId">
    	UPDATE `af_user_withhold` SET
    		is_withhold=#{isSwInteger},
    		lastopen_time=now()
    	WHERE is_delete = 0
    	AND
    	user_id=#{userId}
    </update>

    <update id="updateAfUserWithholdDo"  parameterType="com.ald.fanbei.api.dal.domain.AfUserWithholdDo">
        UPDATE af_user_withhold
          <set>
          	gmt_modified=now(),
            <if test="cardNumber1 != null ">        
                card_number1 = #{cardNumber1,jdbcType=VARCHAR},    
            </if>
            <if test="cardId1 != null "> 
                card_id1=#{cardId1,jdbcType=BIGINT},            
            </if>
            <if test="cardNumber2 != null ">        
                card_number2 = #{cardNumber2,jdbcType=VARCHAR}, 
            </if>
            <if test="cardId2 != null "> 
                card_id2=#{cardId2,jdbcType=BIGINT},            
            </if>
            <if test="cardNumber3 != null ">        
                card_number3 = #{cardNumber3,jdbcType=VARCHAR}, 
            </if>
            <if test="cardId3 != null "> 
                card_id3=#{cardId3,jdbcType=BIGINT},            
            </if>
            <if test="cardNumber4 != null ">        
                card_number4 = #{cardNumber4,jdbcType=VARCHAR},
            </if>
            <if test="cardId4 != null "> 
                card_id4=#{cardId4,jdbcType=BIGINT},            
            </if>
            <if test="cardNumber5 != null ">        
                card_number5 = #{cardNumber5,jdbcType=VARCHAR},
            </if>
            <if test="cardId5 != null "> 
                card_id5=#{cardId5,jdbcType=BIGINT},            
            </if>
            <if test="usebalance != null">        
                usebalance = #{usebalance,jdbcType=INTEGER},               
            </if>
        </set>    
        WHERE is_delete = 0 AND user_id =#{userId}
    </update>

    <select id="getCountByUserId" resultType="java.lang.Integer" parameterType="com.ald.fanbei.api.dal.domain.AfUserWithholdDo">
        SELECT
        count(1)
        FROM af_user_withhold
        WHERE user_id = #{userId} and is_delete=0
    </select>
    
    <select id="getWithholdInfo" parameterType="java.lang.Long" resultType="com.ald.fanbei.api.dal.domain.AfUserWithholdDo">
    	SELECT
        	<include refid="queryFields" />
        FROM af_user_withhold
        WHERE is_delete = 0
        AND user_id=#{userId}
    </select>
    
</mapper>
